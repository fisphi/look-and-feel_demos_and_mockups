<!DOCTYPE html>
<html lang="de">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Personendaten-Formular</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://unpkg.com/alpinejs@3.13.10/dist/cdn.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/yup@1.4.0/dist/yup.min.js"></script>
  <style>
    [x-cloak] {
      display: none !important;
    }

    body {
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(160deg, #eef2ff 0%, #f8fafc 40%, #fff 100%);
      min-height: 100vh;
    }

    .choice-tile {
      position: relative;
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
      border-radius: 1.5rem;
      border: 2px solid rgba(148, 163, 184, 0.25);
      background: rgba(255, 255, 255, 0.85);
      padding: 1.75rem;
      color: rgb(71 85 105);
      transition: all 0.2s ease;
      min-height: 12rem;
    }

    .choice-tile:hover {
      border-color: rgba(14, 165, 233, 0.4);
      box-shadow: 0 16px 40px rgba(148, 163, 184, 0.22);
      transform: translateY(-2px);
    }

    .choice-tile:focus-within {
      border-color: rgba(59, 130, 246, 0.6);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.18);
    }

    .choice-tile .choice-title {
      font-size: 0.95rem;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      color: inherit;
    }

    .choice-tile .choice-description {
      font-size: 0.9rem;
      line-height: 1.55;
      color: rgba(71, 85, 105, 0.85);
      margin-top: 0.75rem;
    }

    .choice-tile.choice-selected {
      transform: translateY(-3px);
      box-shadow: 0 22px 45px rgba(148, 163, 184, 0.28);
      border-color: rgba(14, 165, 233, 0.35);
    }

    .choice-tile.choice-selected .choice-description {
      color: rgba(51, 65, 85, 0.85);
    }

    .choice-tile.choice-live.choice-selected {
      background: linear-gradient(150deg, rgba(224, 242, 254, 0.95), rgba(191, 219, 254, 0.85));
      border-color: rgba(14, 165, 233, 0.65);
      color: rgb(30 41 59);
    }

    .choice-tile.choice-dead.choice-selected {
      background: linear-gradient(150deg, rgba(254, 226, 226, 0.95), rgba(251, 207, 232, 0.85));
      border-color: rgba(236, 72, 153, 0.55);
      color: rgb(76 29 149);
    }

    .choice-tile.choice-unknown.choice-selected {
      background: linear-gradient(150deg, rgba(254, 243, 199, 0.95), rgba(253, 230, 138, 0.85));
      border-color: rgba(245, 158, 11, 0.55);
      color: rgb(120 53 15);
    }

    .tooltip-button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 1.65rem;
      height: 1.65rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 600;
      background-color: rgb(219 234 254);
      color: rgb(30 64 175);
    }

    .tooltip-button:focus {
      outline: 2px solid rgb(14 165 233);
      outline-offset: 2px;
    }

    .status-indicator {
      position: absolute;
      top: 1rem;
      right: 1rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 1.75rem;
      height: 1.75rem;
      border-radius: 9999px;
      border: 2px solid rgba(148, 163, 184, 0.4);
      color: transparent;
      font-size: 0.8rem;
      font-weight: 600;
      transition: all 0.2s ease;
    }

    .status-indicator-active {
      color: rgb(15 118 110);
      border-color: rgb(45 212 191);
      background-color: rgb(236 253 245);
      box-shadow: 0 8px 20px rgba(16, 185, 129, 0.25);
    }

    .status-indicator-active.sky {
      color: rgb(255 255 255);
      /* make icon white */
      border-color: rgb(96 165 250);
      background-color: rgb(37 99 235);
      /* fill with highlight color (blue) */
      box-shadow: 0 8px 20px rgba(59, 130, 246, 0.25);
    }

    .status-indicator-active.rose {
      color: rgb(255 255 255);
      /* make icon white */
      border-color: rgb(244 114 182);
      background-color: rgb(190 24 93);
      /* fill with highlight color (rose) */
      box-shadow: 0 8px 20px rgba(244, 114, 182, 0.25);
    }

    .status-indicator-active.amber {
      color: rgb(255 255 255);
      /* make icon white */
      border-color: rgb(251 191 36);
      background-color: rgb(217 119 6);
      /* fill with highlight color (amber) */
      box-shadow: 0 8px 20px rgba(251, 191, 36, 0.25);
    }
  </style>
</head>

<body>
  <main class="max-w-6xl mx-auto px-4 lg:px-10 py-12">
    <div class="space-y-12" x-data="personForm()" x-init="init()" x-cloak>
      <header
        class="bg-white/80 backdrop-blur border border-slate-200/60 rounded-3xl p-10 shadow-lg shadow-indigo-100/40 space-y-6">
        <div class="space-y-3">
          <p class="text-xs uppercase tracking-[0.25em] text-slate-500">Personenformular <i>look&feel</i></p>
          <h1 class="text-3xl sm:text-4xl font-semibold text-slate-800">Mock-up zur Erfassung von Personendaten</h1>
        </div>
        <p class="text-sm sm:text-base leading-relaxed text-slate-600 max-w-3xl">
          Bitte beantworten Sie zuerst, ob die Person lebend oder verstorben ist. Je nach Auswahl werden nicht benötigte
          Felder automatisch ausgeblendet.
          Alle Eingabefelder lassen sich auch komfortabel per Tastatur erledigen.
        </p>
        <div x-show="success"
          class="rounded-2xl border border-emerald-200 bg-emerald-50 px-4 py-3 text-emerald-700 text-sm" role="alert">
          Datensatz wurde erfolgreich geprüft. (Demo: Es findet kein Speichern statt.)
        </div>
      </header>

      <form @submit.prevent="submit" novalidate class="space-y-16">
        <!-- Lebensstatus Auswahl -->
        <section
          class="bg-white/80 backdrop-blur border border-slate-200/70 rounded-3xl p-10 shadow-md shadow-slate-200/50 space-y-8">
          <div class="space-y-3">
            <h2 class="text-2xl font-semibold text-slate-800">1. Status der Person</h2>
            <p class="text-sm text-slate-500 max-w-3xl">
              Diese Entscheidung steuert, welche Felder angezeigt werden. Wählen Sie „lebend“ oder „verstorben“. Falls
              der Status unbekannt ist,
              wählen Sie „unbekannt“, um alle relevanten Felder einzublenden.
            </p>
          </div>
          <div class="grid gap-6 md:grid-cols-3" role="radiogroup" aria-label="Status der Person">
            <label class="relative cursor-pointer choice-tile choice-live"
              :class="form.lebensstatus === 'lebend' ? 'choice-selected' : ''" for="lebensstatus-lebend"
              @keydown.enter.prevent="form.lebensstatus = 'lebend'"
              @keydown.space.prevent="form.lebensstatus = 'lebend'" :aria-checked="form.lebensstatus === 'lebend'">
              <input class="sr-only" type="radio" name="lebensstatus" id="lebensstatus-lebend" value="lebend"
                x-model="form.lebensstatus">
              <div class="choice-title">Lebende Person</div>
              <p class="choice-description">Kontaktfelder bleiben aktiv, Angaben zum Sterben werden ausgeblendet.</p>
              <!-- <span class="status-indicator"
                :class="form.lebensstatus === 'lebend' ? 'status-indicator-active sky' : ''" aria-hidden="true">
                <svg x-show="form.lebensstatus === 'lebend'" xmlns="http://www.w3.org/2000/svg"
                  class="h-4 w-4 text-sky-700" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                  <path fill-rule="evenodd"
                    d="M16.707 5.293a1 1 0 00-1.414-1.414L8 11.172 4.707 7.879a1 1 0 10-1.414 1.414l4 4a1 1 0 001.414 0l8-8z"
                    clip-rule="evenodd" />
                </svg>
              </span> -->
            </label>

            <label class="relative cursor-pointer choice-tile choice-dead"
              :class="form.lebensstatus === 'verstorben' ? 'choice-selected' : ''" for="lebensstatus-verstorben"
              @keydown.enter.prevent="form.lebensstatus = 'verstorben'"
              @keydown.space.prevent="form.lebensstatus = 'verstorben'"
              :aria-checked="form.lebensstatus === 'verstorben'">
              <input class="sr-only" type="radio" name="lebensstatus" id="lebensstatus-verstorben" value="verstorben"
                x-model="form.lebensstatus">
              <div class="choice-title">Verstorbene Person</div>
              <p class="choice-description">Kontaktdaten werden ausgeblendet, Sterbedaten aktiviert.</p>
              <!-- <span class="status-indicator"
                :class="form.lebensstatus === 'verstorben' ? 'status-indicator-active rose' : ''" aria-hidden="true">
                <svg x-show="form.lebensstatus === 'verstorben'" xmlns="http://www.w3.org/2000/svg"
                  class="h-4 w-4 text-rose-600" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                  <path fill-rule="evenodd"
                    d="M16.707 5.293a1 1 0 00-1.414-1.414L8 11.172 4.707 7.879a1 1 0 10-1.414 1.414l4 4a1 1 0 001.414 0l8-8z"
                    clip-rule="evenodd" />
                </svg>
              </span> -->
            </label>

            <label class="relative cursor-pointer choice-tile choice-unknown"
              :class="form.lebensstatus === 'unbekannt' ? 'choice-selected' : ''" for="lebensstatus-unbekannt"
              @keydown.enter.prevent="form.lebensstatus = 'unbekannt'"
              @keydown.space.prevent="form.lebensstatus = 'unbekannt'"
              :aria-checked="form.lebensstatus === 'unbekannt'">
              <input class="sr-only" type="radio" name="lebensstatus" id="lebensstatus-unbekannt" value="unbekannt"
                x-model="form.lebensstatus">
              <div class="choice-title">Status unbekannt</div>
              <p class="choice-description">Es werden keine Felder automatisch ausgeblendet.</p>
              <!-- <span class="status-indicator"
                :class="form.lebensstatus === 'unbekannt' ? 'status-indicator-active amber' : ''" aria-hidden="true">
                <svg x-show="form.lebensstatus === 'unbekannt'" xmlns="http://www.w3.org/2000/svg"
                  class="h-4 w-4 text-amber-700" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                  <path fill-rule="evenodd"
                    d="M16.707 5.293a1 1 0 00-1.414-1.414L8 11.172 4.707 7.879a1 1 0 10-1.414 1.414l4 4a1 1 0 001.414 0l8-8z"
                    clip-rule="evenodd" />
                </svg>
              </span> -->
            </label>
          </div>
          <p x-show="errors.lebensstatus" x-text="errors.lebensstatus" class="text-sm text-red-600"></p>
        </section>

        <!-- Kernidentität -->
        <section
          class="bg-white/80 backdrop-blur border border-slate-200/70 rounded-3xl p-10 shadow-md shadow-slate-200/50 space-y-8">
          <div class="space-y-2">
            <h2 class="text-2xl font-semibold text-slate-800">2. Kernidentität</h2>
            <p class="text-sm text-slate-500">Pflichtfelder sind mit * markiert. Tooltips enthalten Beschreibung und
              Beispiele aus der Tabelle.</p>
          </div>
          <div class="grid gap-8 md:grid-cols-2">
            <div>
              <div class="flex items-center gap-2">
                <label for="vorname" class="text-sm font-medium text-slate-700">Vorname</label>
                <button type="button" class="tooltip-button" tabindex="-1" tabindex="-1"
                  title="Vorname der Person. Beispiel: Jane oder J.">i</button>
              </div>
              <input id="vorname" name="vorname" type="text" autocomplete="given-name" x-model.trim="form.vorname"
                class="mt-2 block w-full rounded-2xl border bg-white px-4 py-3 text-sm shadow-sm focus:outline-none focus:ring-2"
                :class="inputClass('vorname')">
              <p class="mt-2 text-xs text-slate-500">Buchstaben, Leerzeichen, Punkt und Bindestrich; max. 255 Zeichen.
              </p>
              <p x-show="errors.vorname" x-text="errors.vorname" class="mt-2 text-sm text-red-600"></p>
            </div>
            <div>
              <div class="flex items-center gap-2">
                <label for="nachname" class="text-sm font-medium text-slate-700">Nachname <span
                    class="text-red-600">*</span></label>
                <button type="button" class="tooltip-button" tabindex="-1"
                  title="Nachname der Person. Beispiel: Doe oder D.">i</button>
              </div>
              <input id="nachname" name="nachname" type="text" autocomplete="family-name" x-model.trim="form.nachname"
                class="mt-2 block w-full rounded-2xl border bg-white px-4 py-3 text-sm shadow-sm focus:outline-none focus:ring-2"
                :class="inputClass('nachname')">
              <p class="mt-2 text-xs text-slate-500">Buchstaben, Leerzeichen, Punkt und Bindestrich; max. 255 Zeichen.
              </p>
              <p x-show="errors.nachname" x-text="errors.nachname" class="mt-2 text-sm text-red-600"></p>
            </div>
          </div>

          <div class="grid gap-8 md:grid-cols-2">
            <div>
              <div class="flex items-center gap-2">
                <label for="mittelname" class="text-sm font-medium text-slate-700">Mittelname / Zweitname</label>
                <button type="button" class="tooltip-button" tabindex="-1"
                  title="Zweitname oder weiterer Vorname, optional.">i</button>
              </div>
              <input id="mittelname" name="mittelname" type="text" x-model.trim="form.mittelname"
                class="mt-2 block w-full rounded-2xl border bg-white px-4 py-3 text-sm shadow-sm focus:outline-none focus:ring-2"
                :class="inputClass('mittelname')">
              <p class="mt-2 text-xs text-slate-500">Buchstaben, Leerzeichen, Punkt und Bindestrich; max. 255 Zeichen.
              </p>
              <p x-show="errors.mittelname" x-text="errors.mittelname" class="mt-2 text-sm text-red-600"></p>
            </div>
            <div class="flex items-center gap-2">
              <label for="namenskuerzel" class="text-sm font-medium text-slate-700">Namenskürzel</label>
              <button type="button" class="tooltip-button"
                title="Historisches Namenskürzel, z. B. J. Natterer.">i</button>
            </div>
            <input id="namenskuerzel" name="namenskuerzel" type="text" x-model.trim="form.namenskuerzel"
              placeholder="z. B. J.J.F. Natterer"
              class="mt-2 block w-full rounded-2xl border bg-white px-4 py-3 text-sm shadow-sm focus:outline-none focus:ring-2"
              :class="inputClass('namenskuerzel')">
            <p class="mt-2 text-xs text-slate-500">Max. 50 Zeichen; Erlaubt sind Buchstaben, Punkt, Leerzeichen,
              Bindestrich.</p>
            <p x-show="errors.namenskuerzel" x-text="errors.namenskuerzel" class="mt-2 text-sm text-red-600"></p>
          </div>
          <div>
          </div>
          <div >
            <div class="flex items-center gap-2">
              <label for="anzeigename" class="text-sm font-medium text-slate-700">Anzeigename <span
                  class="text-red-600">*</span></label>
              <button type="button" class="tooltip-button"
                title="Normierter Anzeigename. Beispiel: &quot;Doe, Jane&quot;.">i</button>
            </div>
            <input id="anzeigename" name="anzeigename" type="text" x-model.trim="form.anzeigename"
              placeholder="Nachname, Vorname"
              class="mt-2 block w-full rounded-2xl border bg-white px-4 py-3 text-sm shadow-sm focus:outline-none focus:ring-2"
              :class="inputClass('anzeigename')">
            <p class="mt-2 text-xs text-slate-500">Pflichtfeld; max. 255 Zeichen.</p>
            <p x-show="errors.anzeigename" x-text="errors.anzeigename" class="mt-2 text-sm text-red-600"></p>
          </div>

        </section>

        <!-- Namensvarianten -->
        <section
          class="bg-white/80 backdrop-blur border border-slate-200/70 rounded-3xl p-10 shadow-md shadow-slate-200/50 space-y-8">
          <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
            <div>
              <h2 class="text-2xl font-semibold text-slate-800">3. Namensvarianten</h2>
              <p class="text-sm text-slate-500">Alias- oder Variantenamen können mehrfach ergänzt werden.</p>
            </div>
            <button type="button" @click="addNamensvariante"
              class="inline-flex items-center gap-2 rounded-full border border-slate-300 bg-white px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100 focus:outline-none focus:ring-2 focus:ring-sky-500">
              + weitere Variante hinzufügen
            </button>
          </div>

          <template x-for="(alias, index) in form.namensvarianten" :key="'alias-'+index">
            <div class="rounded-2xl border border-slate-200 bg-slate-50/60 px-4 py-4">
              <div class="flex items-center gap-2">
                <label :for="`namensvariante-${index}`" class="text-sm font-medium text-slate-700">Namensvariante <span
                    x-text="index + 1"></span></label>
                <button type="button" class="tooltip-button"
                  title="Alias-/Variantenname, Freitext bis 255 Zeichen.">i</button>
                <button type="button" @click="removeNamensvariante(index)" x-show="form.namensvarianten.length > 1"
                  class="ml-auto inline-flex items-center gap-1 text-xs font-medium text-rose-600 hover:text-rose-700 focus:outline-none">Entfernen</button>
              </div>
              <input :id="`namensvariante-${index}`" type="text" x-model.trim="form.namensvarianten[index]"
                class="mt-3 block w-full rounded-2xl border bg-white px-4 py-3 text-sm shadow-sm focus:outline-none focus:ring-2"
                :class="inputClass('namensvarianten[' + index + ']')">
              <p class="mt-2 text-xs text-slate-500">Freitext, max. 255 Zeichen.</p>
              <p x-show="errors['namensvarianten[' + index + ']']" x-text="errors['namensvarianten[' + index + ']']"
                class="mt-2 text-sm text-red-600"></p>
            </div>
          </template>

          <div class="grid gap-8 md:grid-cols-2">
            <div>
              <div class="flex items-center gap-2">
                <label for="aliase" class="text-sm font-medium text-slate-700">Aliase</label>
                <button type="button" class="tooltip-button"
                  title="Alternative Namensschreibungen als Freitext (max. 255 Zeichen pro Eintrag, getrennt durch Semikolon).">i</button>
              </div>
              <input id="aliase" name="aliase" rows="3" type="text" x-model.trim="form.aliase"
                class="mt-2 block w-full rounded-2xl border bg-white px-4 py-3 text-sm shadow-sm focus:outline-none focus:ring-2"
                :class="inputClass('aliase')" placeholder="z. B. Jane Doe; Johanna Doe"></input>
              <p class="mt-2 text-xs text-slate-500">Weitere Schreibweisen, getrennt durch Semikolon.</p>
              <p x-show="errors.aliase" x-text="errors.aliase" class="mt-2 text-sm text-red-600"></p>
            </div>
            <div>
              <div class="flex items-center gap-2">
                <label for="aliasNamenskuerzel" class="text-sm font-medium text-slate-700">Aliase Namenskürzel</label>
                <button type="button" class="tooltip-button"
                  title="Abweichende Namenskürzel für Aliasnamen (max. 50 Zeichen, getrennt durch Semikolon).">i</button>
              </div>
              <input id="aliasNamenskuerzel" name="aliasNamenskuerzel" type="text"
                x-model.trim="form.aliasNamenskuerzel" placeholder="z. B. J.D.; J.N."
                class="mt-2 block w-full rounded-2xl border bg-white px-4 py-3 text-sm shadow-sm focus:outline-none focus:ring-2"
                :class="inputClass('aliasNamenskuerzel')">
              <p class="mt-2 text-xs text-slate-500">Mehrere Kürzel durch Semikolon trennen.</p>
              <p x-show="errors.aliasNamenskuerzel" x-text="errors.aliasNamenskuerzel"
                class="mt-2 text-sm text-red-600"></p>
            </div>
          </div>
        </section>

        <!-- Akademische und historische Titel -->
        <section
          class="bg-white/80 backdrop-blur border border-slate-200/70 rounded-3xl p-10 shadow-md shadow-slate-200/50 space-y-8">
          <div class="space-y-2">
            <h2 class="text-2xl font-semibold text-slate-800">4. Akademische und historische Titel</h2>
            <p class="text-sm text-slate-500">Titelangaben werden getrennt erfasst und können über Autocomplete ergänzt werden.</p>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <div class="flex items-center gap-2">
                <label for="adelstitel" class="text-sm font-medium text-slate-700">Historische Titel / Adelstitel</label>
                <button type="button" class="tooltip-button"
                  title="Historischer Adelstitel. Beispiel: Graf von.">i</button>
              </div>
              <input id="adelstitel" name="adelstitel" type="text" list="adelstitel-options"
                x-model.trim="form.adelstitel"
                class="mt-2 block w-full rounded-2xl border bg-white px-4 py-3 text-sm shadow-sm focus:outline-none focus:ring-2"
                :class="inputClass('adelstitel')" placeholder="z. B. Graf von">
              <datalist id="adelstitel-options">
                <option value="Graf"></option>
                <option value="Gräfin"></option>
                <option value="Freiherr"></option>
                <option value="Freifrau"></option>
                <option value="Baron"></option>
                <option value="Baronin"></option>
                <option value="Ritter"></option>
                <option value="Fürst"></option>
                <option value="Fürstin"></option>
                <option value="Herzog"></option>
                <option value="Herzogin"></option>
                <option value="Landgraf"></option>
                <option value="Landgräfin"></option>
              </datalist>
              <p class="mt-2 text-xs text-slate-500">Autocomplete mit Dummy-Werten; freie Eingabe bis 100 Zeichen
                möglich.</p>
              <p x-show="errors.adelstitel" x-text="errors.adelstitel" class="mt-2 text-sm text-red-600"></p>
            </div>
            <div>
              <div class="flex items-center gap-2">
                <label for="akademischerTitel" class="text-sm font-medium text-slate-700">Akademischer Titel</label>
                <button type="button" class="tooltip-button" title="Akademischer Grad. Beispiel: Dr., Prof.">i</button>
              </div>
              <input id="akademischerTitel" name="akademischerTitel" type="text" x-model.trim="form.akademischerTitel"
                class="mt-2 block w-full rounded-2xl border bg-white px-4 py-3 text-sm shadow-sm focus:outline-none focus:ring-2"
                :class="inputClass('akademischerTitel')" placeholder="z. B. Dr.">
              <p class="mt-2 text-xs text-slate-500">Optional; max. 100 Zeichen, idealerweise aus kontrollierter Liste.
              </p>
              <p x-show="errors.akademischerTitel" x-text="errors.akademischerTitel" class="mt-2 text-sm text-red-600">
              </p>
            </div>
          </div>
        </section>

        <!-- Lebensdaten -->
        <section
          class="bg-white/80 backdrop-blur border border-slate-200/70 rounded-3xl p-10 shadow-md shadow-slate-200/50 space-y-10">
          <div class="space-y-2">
            <h2 class="text-2xl font-semibold text-slate-800">5. Lebensdaten</h2>
            <p class="text-sm text-slate-500">Sterbedaten und -orte werden automatisch ausgeblendet, wenn eine lebende
              Person gewählt wurde.</p>
          </div>

          <div class="space-y-8">
            <div class="grid gap-6 md:grid-cols-2">
              <div>
                <div class="flex items-center gap-2">
                  <label for="geburtsdatum" class="text-sm font-medium text-slate-700">Geburtsdatum</label>
                  <button type="button" class="tooltip-button" title="Jahr, Monat, Tag soweit bekannt. Beispiel: 1824-05.">i</button>
                </div>
                <input id="geburtsdatum" name="geburtsdatum" type="text" placeholder="YYYY oder YYYY-MM(-DD)"
                  x-model.trim="form.geburtsdatum"
                  class="mt-2 block w-full rounded-2xl border bg-white px-4 py-3 text-sm shadow-sm focus:outline-none focus:ring-2"
                  :class="inputClass('geburtsdatum')">
                <p class="mt-2 text-xs text-slate-500">ISO-ähnliches Format.</p>
                <p x-show="errors.geburtsdatum" x-text="errors.geburtsdatum" class="mt-2 text-sm text-red-600"></p>
              </div>
              <div>
                <div class="flex items-center gap-2">
                  <label for="geburtsort" class="text-sm font-medium text-slate-700">Geburtsort</label>
                  <button type="button" class="tooltip-button" title="Ort der Geburt, Freitext.">i</button>
                </div>
                <input id="geburtsort" name="geburtsort" type="text" x-model.trim="form.geburtsort"
                  class="mt-2 block w-full rounded-2xl border bg-white px-4 py-3 text-sm shadow-sm focus:outline-none focus:ring-2"
                  :class="inputClass('geburtsort')">
                <p class="mt-2 text-xs text-slate-500">Freitext bis 255 Zeichen.</p>
                <p x-show="errors.geburtsort" x-text="errors.geburtsort" class="mt-2 text-sm text-red-600"></p>
              </div>
            </div>

            <div class="grid gap-6 md:grid-cols-2" x-show="isFieldVisible('sterbedatum') || isFieldVisible('sterbeort')" x-transition>
              <div x-show="isFieldVisible('sterbedatum')" x-transition>
                <div class="flex items-center gap-2">
                  <label for="sterbedatum" class="text-sm font-medium text-slate-700">Sterbedatum</label>
                  <button type="button" class="tooltip-button" title="Jahr, Monat, Tag des Todes soweit bekannt.">i</button>
                </div>
                <input id="sterbedatum" name="sterbedatum" type="text" placeholder="YYYY oder YYYY-MM(-DD)"
                  x-model.trim="form.sterbedatum"
                  class="mt-2 block w-full rounded-2xl border bg-white px-4 py-3 text-sm shadow-sm focus:outline-none focus:ring-2"
                  :class="inputClass('sterbedatum')" :disabled="!isFieldVisible('sterbedatum')">
                <p class="mt-2 text-xs text-slate-500">Nur bei verstorbenen Personen.</p>
                <p x-show="errors.sterbedatum" x-text="errors.sterbedatum" class="mt-2 text-sm text-red-600"></p>
              </div>
              <div x-show="isFieldVisible('sterbeort')" x-transition>
                <div class="flex items-center gap-2">
                  <label for="sterbeort" class="text-sm font-medium text-slate-700">Sterbeort</label>
                  <button type="button" class="tooltip-button" title="Ort des Todes, Freitext.">i</button>
                </div>
                <input id="sterbeort" name="sterbeort" type="text" x-model.trim="form.sterbeort"
                  class="mt-2 block w-full rounded-2xl border bg-white px-4 py-3 text-sm shadow-sm focus:outline-none focus:ring-2"
                  :class="inputClass('sterbeort')" :disabled="!isFieldVisible('sterbeort')">
                <p class="mt-2 text-xs text-slate-500">Nur bei verstorbenen Personen.</p>
                <p x-show="errors.sterbeort" x-text="errors.sterbeort" class="mt-2 text-sm text-red-600"></p>
              </div>
            </div>

            <div class="space-y-3">
              <div class="flex items-center gap-2">
                <span class="text-sm font-medium text-slate-700">Geschlecht</span>
                <button type="button" class="tooltip-button" title="Optional; mehrere Angaben möglich.">i</button>
              </div>
              <p class="text-xs text-slate-500">Optional; Auswahl über Checkboxen.</p>
              <div class="flex flex-wrap gap-3" :class="errors.geschlecht ? 'ring-2 ring-rose-300 rounded-xl px-3 py-2' : ''">
                <template x-for="option in geschlechtOptions" :key="option.id">
                  <label :for="`geschlecht-option-${option.id}`" class="inline-flex items-center gap-2 rounded-full border border-slate-300 bg-white px-3 py-1.5 text-sm text-slate-700 shadow-sm hover:bg-slate-100 focus-within:ring-2 focus-within:ring-sky-500">
                    <input type="checkbox" class="h-4 w-4 rounded border-slate-300 text-sky-500 focus:ring-sky-500"
                      :value="option.value" x-model="form.geschlecht" :id="`geschlecht-option-${option.id}`">
                    <span x-text="option.label"></span>
                  </label>
                </template>
              </div>
              <p x-show="errors.geschlecht" x-text="errors.geschlecht" class="text-sm text-red-600"></p>
            </div>

            <div>
              <div class="flex items-center gap-2">
                <label for="wirkungsorte" class="text-sm font-medium text-slate-700">Wirkungsorte</label>
                <button type="button" class="tooltip-button" title="Weitere relevante Orte, getrennt durch Semikolon.">i</button>
              </div>
              <textarea id="wirkungsorte" name="wirkungsorte" rows="2" x-model.trim="form.wirkungsorte"
                class="mt-2 block w-full rounded-2xl border bg-white px-4 py-3 text-sm shadow-sm focus:outline-none focus:ring-2"
                :class="inputClass('wirkungsorte')" placeholder="z. B. Wien; Triest"></textarea>
              <p class="mt-2 text-xs text-slate-500">Mehrere Orte möglich; max. 500 Zeichen.</p>
              <p x-show="errors.wirkungsorte" x-text="errors.wirkungsorte" class="mt-2 text-sm text-red-600"></p>
            </div>
          </div>
        </section>

        <!-- Biografie und Institution -->
        <section
          class="bg-white/80 backdrop-blur border border-slate-200/70 rounded-3xl p-10 shadow-md shadow-slate-200/50 space-y-10">
          <div class="space-y-2">
            <h2 class="text-2xl font-semibold text-slate-800">6. Biografie &amp; Institution</h2>
            <p class="text-sm text-slate-500">Freitextfelder für berufliche Rollen und Zuordnungen.</p>
          </div>

          <div class="grid gap-8 md:grid-cols-2">
            <div class="md:col-span-2">
              <div class="flex items-center gap-2">
                <label for="berufFunktion" class="text-sm font-medium text-slate-700">Beruf / Funktion</label>
                <button type="button" class="tooltip-button"
                  title="Beruf oder Rolle außerhalb einer Institution.">i</button>
              </div>
              <input id="berufFunktion" name="berufFunktion" type="text" x-model.trim="form.berufFunktion"
                class="mt-2 block w-full rounded-2xl border bg-white px-4 py-3 text-sm shadow-sm focus:outline-none focus:ring-2"
                :class="inputClass('berufFunktion')" placeholder="z. B. Zoologe, Botanikerin">
              <p class="mt-2 text-xs text-slate-500">Freitext, max. 255 Zeichen.</p>
              <p x-show="errors.berufFunktion" x-text="errors.berufFunktion" class="mt-2 text-sm text-red-600"></p>
            </div>
          </div>

          <div class="grid gap-8 md:grid-cols-3">
            <div>
              <div class="flex items-center gap-2">
                <label for="institution" class="text-sm font-medium text-slate-700">Institution</label>
                <button type="button" class="tooltip-button"
                  title="Zugehörige Institution; Referenz auf Stammdatensatz empfohlen.">i</button>
              </div>
              <input id="institution" name="institution" type="text" x-model.trim="form.institution"
                class="mt-2 block w-full rounded-2xl border bg-white px-4 py-3 text-sm shadow-sm focus:outline-none focus:ring-2"
                :class="inputClass('institution')">
              <p class="mt-2 text-xs text-slate-500">Optional; max. 255 Zeichen.</p>
              <p x-show="errors.institution" x-text="errors.institution" class="mt-2 text-sm text-red-600"></p>
            </div>
            <div>
              <div class="flex items-center gap-2">
                <label for="abteilung" class="text-sm font-medium text-slate-700">Abteilung</label>
                <button type="button" class="tooltip-button" title="Zugehörige Abteilung; optional.">i</button>
              </div>
              <input id="abteilung" name="abteilung" type="text" x-model.trim="form.abteilung"
                class="mt-2 block w-full rounded-2xl border bg-white px-4 py-3 text-sm shadow-sm focus:outline-none focus:ring-2"
                :class="inputClass('abteilung')">
              <p class="mt-2 text-xs text-slate-500">Optional; max. 255 Zeichen.</p>
              <p x-show="errors.abteilung" x-text="errors.abteilung" class="mt-2 text-sm text-red-600"></p>
            </div>
            <div>
              <div class="flex items-center gap-2">
                <label for="rolle" class="text-sm font-medium text-slate-700">Rolle</label>
                <button type="button" class="tooltip-button"
                  title="Rolle/Funktion im Sammlungs- oder Projektkontext.">i</button>
              </div>
              <input id="rolle" name="rolle" type="text" x-model.trim="form.rolle"
                class="mt-2 block w-full rounded-2xl border bg-white px-4 py-3 text-sm shadow-sm focus:outline-none focus:ring-2"
                :class="inputClass('rolle')" placeholder="z. B. Sammler, Bearbeiter">
              <p class="mt-2 text-xs text-slate-500">Optional; max. 255 Zeichen.</p>
              <p x-show="errors.rolle" x-text="errors.rolle" class="mt-2 text-sm text-red-600"></p>
            </div>
          </div>

          <div class="grid gap-8 md:grid-cols-2">
            <div>
              <div class="flex items-center gap-2">
                <label for="zeitraum" class="text-sm font-medium text-slate-700">Zeitraum</label>
                <button type="button" class="tooltip-button"
                  title="Zeitraum der Tätigkeit. Beispiele: 1850-1900, seit 1920.">i</button>
              </div>
              <input id="zeitraum" name="zeitraum" type="text" x-model.trim="form.zeitraum"
                placeholder="z. B. 1850-1900"
                class="mt-2 block w-full rounded-2xl border bg-white px-4 py-3 text-sm shadow-sm focus:outline-none focus:ring-2"
                :class="inputClass('zeitraum')">
              <p class="mt-2 text-xs text-slate-500">Erlaubte Muster: YYYY, YYYY-YYYY, seit YYYY.</p>
              <p x-show="errors.zeitraum" x-text="errors.zeitraum" class="mt-2 text-sm text-red-600"></p>
            </div>
            <div>
              <div class="flex items-center gap-2">
                <label for="adresseRoh" class="text-sm font-medium text-slate-700">Adresse (archiviert)</label>
                <button type="button" class="tooltip-button"
                  title="Frühere Anschriften, Freitext bis 500 Zeichen.">i</button>
              </div>
              <textarea id="adresseRoh" name="adresseRoh" rows="3" x-model.trim="form.adresseRoh"
                class="mt-2 block w-full rounded-2xl border bg-white px-4 py-3 text-sm shadow-sm focus:outline-none focus:ring-2"
                :class="inputClass('adresseRoh')" placeholder="Straße, PLZ, Ort, Land"></textarea>
              <p class="mt-2 text-xs text-slate-500">Historische Anschriften (Freitext).</p>
              <p x-show="errors.adresseRoh" x-text="errors.adresseRoh" class="mt-2 text-sm text-red-600"></p>
            </div>
          </div>
        </section>

        <!-- Kontakt (nur lebende) -->
        <section x-show="isFieldVisible('kontaktBlock')" x-transition
          class="bg-white/80 backdrop-blur border border-slate-200/70 rounded-3xl p-10 shadow-md shadow-slate-200/50 space-y-10">
          <div class="space-y-2">
            <h2 class="text-2xl font-semibold text-slate-800">7. Kontakt &amp; Profil</h2>
            <p class="text-sm text-slate-500">Diese Angaben werden nur für lebende Personen benötigt.</p>
          </div>

          <div class="grid gap-8 md:grid-cols-3">
            <div x-show="isFieldVisible('email')">
              <div class="flex items-center gap-2">
                <label for="email" class="text-sm font-medium text-slate-700">E-Mail</label>
                <button type="button" class="tooltip-button" title="E-Mail-Adresse (RFC-konform).">i</button>
              </div>
              <input id="email" name="email" type="email" x-model.trim="form.email" autocomplete="email"
                class="mt-2 block w-full rounded-2xl border bg-white px-4 py-3 text-sm shadow-sm focus:outline-none focus:ring-2"
                :class="inputClass('email')" :disabled="!isFieldVisible('email')" placeholder="name@beispiel.org">
              <p class="mt-2 text-xs text-slate-500">Pflicht für lebende Personen.</p>
              <p x-show="errors.email" x-text="errors.email" class="mt-2 text-sm text-red-600"></p>
            </div>
            <div x-show="isFieldVisible('telefon')">
              <div class="flex items-center gap-2">
                <label for="telefon" class="text-sm font-medium text-slate-700">Telefon</label>
                <button type="button" class="tooltip-button"
                  title="Ziffern, +, /, (), Leerzeichen oder Bindestrich (3–50 Zeichen).">i</button>
              </div>
              <input id="telefon" name="telefon" type="tel" x-model.trim="form.telefon" autocomplete="tel"
                class="mt-2 block w-full rounded-2xl border bg-white px-4 py-3 text-sm shadow-sm focus:outline-none focus:ring-2"
                :class="inputClass('telefon')" :disabled="!isFieldVisible('telefon')" placeholder="+43 1 1234567">
              <p class="mt-2 text-xs text-slate-500">Optional, aber nur für lebende Personen relevant.</p>
              <p x-show="errors.telefon" x-text="errors.telefon" class="mt-2 text-sm text-red-600"></p>
            </div>
            <div x-show="isFieldVisible('nhmwProfil')">
              <div class="flex items-center gap-2">
                <label for="nhmwProfil" class="text-sm font-medium text-slate-700">NHMW-Profil (URL)</label>
                <button type="button" class="tooltip-button"
                  title="Interner/öffentlicher Profil-Link des NHMW.">i</button>
              </div>
              <input id="nhmwProfil" name="nhmwProfil" type="url" x-model.trim="form.nhmwProfil"
                class="mt-2 block w-full rounded-2xl border bg-white px-4 py-3 text-sm shadow-sm focus:outline-none focus:ring-2"
                :class="inputClass('nhmwProfil')" :disabled="!isFieldVisible('nhmwProfil')"
                placeholder="https://www.nhm.at/profil">
              <p class="mt-2 text-xs text-slate-500">URL muss mit http:// oder https:// beginnen.</p>
              <p x-show="errors.nhmwProfil" x-text="errors.nhmwProfil" class="mt-2 text-sm text-red-600"></p>
            </div>
          </div>
        </section>

        <!-- Normdaten -->
        <section
          class="bg-white/80 backdrop-blur border border-slate-200/70 rounded-3xl p-10 shadow-md shadow-slate-200/50 space-y-10">
          <div class="space-y-2">
            <h2 class="text-2xl font-semibold text-slate-800">8. Normdaten / Identifier</h2>
            <p class="text-sm text-slate-500">Optional, müssen bei Eingabe aber die definierten Muster einhalten.</p>
          </div>
          <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
            <template x-for="field in normFields" :key="field.name">
              <div>
                <div class="flex items-center gap-2">
                  <label :for="field.name" class="text-sm font-medium text-slate-700" x-text="field.label"></label>
                  <button type="button" class="tooltip-button" :title="`Beschreibung: ${field.description}`">i</button>
                </div>
                <input :id="field.name" :name="field.name" type="text" x-model.trim="form[field.name]"
                  class="mt-2 block w-full rounded-2xl border bg-white px-4 py-3 text-sm shadow-sm focus:outline-none focus:ring-2"
                  :class="inputClass(field.name)">
                <p class="mt-2 text-xs text-slate-500" x-text="field.hint"></p>
                <p x-show="errors[field.name]" x-text="errors[field.name]" class="mt-2 text-sm text-red-600"></p>
              </div>
            </template>
          </div>
        </section>

        <!-- Dokumentation -->
        <section
          class="bg-white/80 backdrop-blur border border-slate-200/70 rounded-3xl p-10 shadow-md shadow-slate-200/50 space-y-10">
          <div class="space-y-2">
            <h2 class="text-2xl font-semibold text-slate-800">9. Dokumentation</h2>
            <p class="text-sm text-slate-500">Freitextfelder für Hinweise, Quellen und Importangaben.</p>
          </div>

          <div class="grid gap-8 md:grid-cols-2">
            <div>
              <div class="flex items-center gap-2">
                <label for="anmerkungen" class="text-sm font-medium text-slate-700">Anmerkungen</label>
                <button type="button" class="tooltip-button" title="Freitext, max. 2000 Zeichen.">i</button>
              </div>
              <textarea id="anmerkungen" name="anmerkungen" rows="3" x-model.trim="form.anmerkungen"
                class="mt-2 block w-full rounded-2xl border bg-white px-4 py-3 text-sm shadow-sm focus:outline-none focus:ring-2"
                :class="inputClass('anmerkungen')"></textarea>
              <p class="mt-2 text-xs text-slate-500">Gedacht für allgemeine Hinweise.</p>
              <p x-show="errors.anmerkungen" x-text="errors.anmerkungen" class="mt-2 text-sm text-red-600"></p>
            </div>
            <div>
              <div class="flex items-center gap-2">
                <label for="kommentar" class="text-sm font-medium text-slate-700">Kommentar</label>
                <button type="button" class="tooltip-button" title="Interner Freitext, max. 2000 Zeichen.">i</button>
              </div>
              <textarea id="kommentar" name="kommentar" rows="3" x-model.trim="form.kommentar"
                class="mt-2 block w-full rounded-2xl border bg-white px-4 py-3 text-sm shadow-sm focus:outline-none focus:ring-2"
                :class="inputClass('kommentar')"></textarea>
              <p class="mt-2 text-xs text-slate-500">Interne Hinweise; nicht für Veröffentlichung.</p>
              <p x-show="errors.kommentar" x-text="errors.kommentar" class="mt-2 text-sm text-red-600"></p>
            </div>
          </div>

          <div class="grid gap-8 md:grid-cols-3">
            <div>
              <div class="flex items-center gap-2">
                <label for="quelle" class="text-sm font-medium text-slate-700">Quelle</label>
                <button type="button" class="tooltip-button"
                  title="Herkunft der Information, max. 255 Zeichen.">i</button>
              </div>
              <input id="quelle" name="quelle" type="text" x-model.trim="form.quelle"
                class="mt-2 block w-full rounded-2xl border bg-white px-4 py-3 text-sm shadow-sm focus:outline-none focus:ring-2"
                :class="inputClass('quelle')" placeholder="z. B. Datenbank Altbestand">
              <p class="mt-2 text-xs text-slate-500">Optionales Anzeige-Feld.</p>
              <p x-show="errors.quelle" x-text="errors.quelle" class="mt-2 text-sm text-red-600"></p>
            </div>
            <div class="md:col-span-2">
              <div class="flex items-center gap-2">
                <label for="quelldaten" class="text-sm font-medium text-slate-700">Quelldaten</label>
                <button type="button" class="tooltip-button"
                  title="Originalangabe als Freitext bis 2000 Zeichen.">i</button>
              </div>
              <textarea id="quelldaten" name="quelldaten" rows="3" x-model.trim="form.quelldaten"
                class="mt-2 block w-full rounded-2xl border bg-white px-4 py-3 text-sm shadow-sm focus:outline-none focus:ring-2"
                :class="inputClass('quelldaten')"></textarea>
              <p class="mt-2 text-xs text-slate-500">Nur Anzeige laut CSV.</p>
              <p x-show="errors.quelldaten" x-text="errors.quelldaten" class="mt-2 text-sm text-red-600"></p>
            </div>
          </div>

          <div class="grid gap-8 md:grid-cols-2">
            <div>
              <div class="flex items-center gap-2">
                <label for="quellimportDatum" class="text-sm font-medium text-slate-700">Quellimport Datum</label>
                <button type="button" class="tooltip-button" title="ISO-8601 Datum (YYYY-MM-DD).">i</button>
              </div>
              <input id="quellimportDatum" name="quellimportDatum" type="text" x-model.trim="form.quellimportDatum"
                placeholder="YYYY-MM-DD"
                class="mt-2 block w-full rounded-2xl border bg-white px-4 py-3 text-sm shadow-sm focus:outline-none focus:ring-2"
                :class="inputClass('quellimportDatum')">
              <p class="mt-2 text-xs text-slate-500">Optional; Anzeige beim Import.</p>
              <p x-show="errors.quellimportDatum" x-text="errors.quellimportDatum" class="mt-2 text-sm text-red-600">
              </p>
            </div>
          </div>
        </section>

        <!-- Form actions -->
        <section class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
          <button type="button" @click="resetForm"
            class="inline-flex items-center justify-center rounded-full border border-slate-300 bg-white px-5 py-2.5 text-sm font-medium text-slate-700 shadow-sm hover:bg-slate-100 focus:outline-none focus:ring-2 focus:ring-sky-500">
            Formular zurücksetzen
          </button>
          <button type="submit"
            class="inline-flex items-center justify-center rounded-full bg-sky-600 px-6 py-2.5 text-sm font-semibold text-white shadow-lg shadow-sky-200 hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-sky-500">
            Eingaben prüfen
          </button>
        </section>
      </form>
    </div>
  </main>

  <script>
    function personForm() {
      const fieldVisibility = {
        sterbedatum: { hideIfLiving: true },
        sterbeort: { hideIfLiving: true },
        email: { hideIfDead: true },
        telefon: { hideIfDead: true },
        nhmwProfil: { hideIfDead: true },
        kontaktBlock: { hideIfDead: true }
      };

      const patterns = {
        personName: /^[A-Za-zÀ-ÖØ-öø-ÿ.' -]{1,255}$/u,
        displayName: /^.{1,255}$/,
        alias: /^.{1,255}$/,
        namenskuerzel: /^[A-Za-zÀ-ÖØ-öø-ÿ.\- ]{1,50}$/u,
        aliasNamenskuerzel: /^[A-Za-zÀ-ÖØ-öø-ÿ.\- ;]{0,255}$/u,
        title: /^.{0,100}$/,
        partialDate: /^\d{4}(?:-\d{2}){0,2}$/,
        timeframe: /^(?:\d{4}(?:[-–]\d{4})?|seit \d{4})$/,
        email: /^[^@\s]+@[^@\s]+\.[^@\s]+$/,
        telefon: /^[0-9+()\/\s-]{3,50}$/,
        url: /^https?:\/\/.+$/,
        ort255: /^.{0,255}$/,
        ort500: /^.{0,500}$/,
        orcid: /^(?:\d{4}-\d{4}-\d{4}-\d{3}[0-9X]|https:\/\/orcid\.org\/\d{4}-\d{4}-\d{4}-\d{3}[0-9X])$/,
        viaf: /^(?:\d+|https:\/\/viaf\.org\/viaf\/\d+)$/,
        gnd: /^(?:1\d{7,8}|https:\/\/d-nb\.info\/gnd\/1\d{7,8})$/,
        wikidata: /^(?:Q\d+|https:\/\/www\.wikidata\.org\/entity\/Q\d+)$/,
        isni: /^\d{15}[0-9X]$/,
        lcnaf: /^(?:n\d{8}|http:\/\/id\.loc\.gov\/authorities\/names\/n\d{8})$/,
        bnf: /^(?:ark:\/12148\/cb\d+|https:\/\/data\.bnf\.fr\/ark:\/12148\/cb\d+)$/,
        bhl: /^(?:https:\/\/www\.biodiversitylibrary\.org\/creator\/\d+|\d+)$/,
        zoobank: /^urn:lsid:zoobank\.org:author:[A-F0-9-]+$/i,
        zobodat: /^(?:https:\/\/www\.zobodat\.at\/personen\.php\?id=\d+|\d+)$/,
        wikipedia: /^(?:https:\/\/[a-z]{2}\.wikipedia\.org\/wiki\/.+)$/,
        ulan: /^(?:5000\d+|https:\/\/vocab\.getty\.edu\/page\/ulan\/5000\d+)$/,
        max2000: /^.{0,2000}$/,
        dateIso: /^\d{4}-\d{2}-\d{2}$/
      };

      const geschlechtOptions = [
        { id: 'maennlich', value: 'männlich', label: 'männlich' },
        { id: 'weiblich', value: 'weiblich', label: 'weiblich' },
        { id: 'divers', value: 'divers', label: 'divers' },
        { id: 'unbekannt', value: 'unbekannt', label: 'unbekannt' }
      ];
      const geschlechtValues = geschlechtOptions.map(option => option.value);

      const schema = yup.object({
        vorname: yup.string().trim().required('Bitte einen Vornamen angeben.').matches(patterns.personName, 'Vorname enthält unzulässige Zeichen oder ist zu lang.'),
        nachname: yup.string().trim().required('Bitte einen Nachnamen angeben.').matches(patterns.personName, 'Nachname enthält unzulässige Zeichen oder ist zu lang.'),
        mittelname: yup.string().trim().matches(patterns.personName, { message: 'Zweitname enthält unzulässige Zeichen.', excludeEmptyString: true }),
        anzeigename: yup.string().trim().required('Bitte einen Anzeigenamen hinterlegen.').matches(patterns.displayName, 'Anzeigename muss zwischen 1 und 255 Zeichen lang sein.'),
        namensvarianten: yup.array().of(
          yup.string().trim().matches(patterns.alias, { message: 'Namensvariante darf höchstens 255 Zeichen besitzen.', excludeEmptyString: true })
        ),
        aliase: yup.string().trim().matches(patterns.ort500, { message: 'Aliase dürfen höchstens 500 Zeichen umfassen.', excludeEmptyString: true }),
        aliasNamenskuerzel: yup.string().trim().matches(patterns.aliasNamenskuerzel, { message: 'Aliase Namenskürzel dürfen nur zulässige Zeichen enthalten und höchstens 255 Zeichen umfassen.', excludeEmptyString: true }),
        namenskuerzel: yup.string().trim().matches(patterns.namenskuerzel, { message: 'Namenskürzel darf maximal 50 Zeichen haben und nur zulässige Zeichen enthalten.', excludeEmptyString: true }),
        adelstitel: yup.string().trim().matches(patterns.title, { message: 'Adelstitel darf höchstens 100 Zeichen haben.', excludeEmptyString: true }),
        akademischerTitel: yup.string().trim().matches(patterns.title, { message: 'Akademischer Titel darf höchstens 100 Zeichen haben.', excludeEmptyString: true }),
        geburtsdatum: yup.string().trim().matches(patterns.partialDate, { message: 'Geburtsdatum bitte als YYYY, YYYY-MM oder YYYY-MM-DD angeben.', excludeEmptyString: true }),
        sterbedatum: yup.string().trim().when('lebensstatus', {
          is: val => val === 'verstorben',
          then: yup.string().trim().required('Sterbedatum ist für verstorbene Personen erforderlich.').matches(patterns.partialDate, 'Sterbedatum bitte als YYYY, YYYY-MM oder YYYY-MM-DD angeben.'),
          otherwise: yup.string().trim().matches(patterns.partialDate, { message: 'Sterbedatum bitte als YYYY, YYYY-MM oder YYYY-MM-DD angeben.', excludeEmptyString: true })
        }),
        lebensstatus: yup.string().oneOf(['lebend', 'verstorben', 'unbekannt'], 'Bitte eine gültige Option wählen.').required('Bitte zunächst den Status festlegen.'),
        geschlecht: yup.array().ensure()
          .of(yup.string().oneOf(geschlechtValues, 'Ungültige Auswahl für Geschlecht.'))
          .max(geschlechtValues.length, 'Ungültige Auswahl für Geschlecht.'),
        berufFunktion: yup.string().trim().matches(patterns.ort255, { message: 'Beruf/Funktion darf höchstens 255 Zeichen umfassen.', excludeEmptyString: true }),
        institution: yup.string().trim().matches(patterns.ort255, { message: 'Institution darf höchstens 255 Zeichen umfassen.', excludeEmptyString: true }),
        abteilung: yup.string().trim().matches(patterns.ort255, { message: 'Abteilung darf höchstens 255 Zeichen umfassen.', excludeEmptyString: true }),
        rolle: yup.string().trim().matches(patterns.ort255, { message: 'Rolle darf höchstens 255 Zeichen umfassen.', excludeEmptyString: true }),
        zeitraum: yup.string().trim().matches(patterns.timeframe, { message: 'Zeitraum bitte als YYYY, YYYY-YYYY oder „seit YYYY“ angeben.', excludeEmptyString: true }),
        adresseRoh: yup.string().trim().matches(patterns.ort500, { message: 'Adresse darf höchstens 500 Zeichen umfassen.', excludeEmptyString: true }),
        email: yup.string().trim().when('lebensstatus', {
          is: val => val === 'lebend',
          then: yup.string().trim().required('Für lebende Personen wird eine E-Mail-Adresse benötigt.').matches(patterns.email, 'Bitte eine gültige E-Mail-Adresse angeben.'),
          otherwise: yup.string().trim().matches(patterns.email, { message: 'Bitte eine gültige E-Mail-Adresse angeben.', excludeEmptyString: true })
        }),
        telefon: yup.string().trim().matches(patterns.telefon, { message: 'Telefonnummer erlaubt nur Ziffern, +, /, (), Leerzeichen und - (3–50 Zeichen).', excludeEmptyString: true }),
        nhmwProfil: yup.string().trim().matches(patterns.url, { message: 'NHMW-Profil muss mit http:// oder https:// beginnen.', excludeEmptyString: true }),
        geburtsort: yup.string().trim().matches(patterns.ort255, { message: 'Geburtsort darf höchstens 255 Zeichen umfassen.', excludeEmptyString: true }),
        sterbeort: yup.string().trim().matches(patterns.ort255, { message: 'Sterbeort darf höchstens 255 Zeichen umfassen.', excludeEmptyString: true }),
        wirkungsorte: yup.string().trim().matches(patterns.ort500, { message: 'Wirkungsorte dürfen höchstens 500 Zeichen umfassen.', excludeEmptyString: true }),
        orcid: yup.string().trim().matches(patterns.orcid, { message: 'ORCID muss als 16-stellige ID oder vollständige URL angegeben werden.', excludeEmptyString: true }),
        viaf: yup.string().trim().matches(patterns.viaf, { message: 'VIAF muss als numerische ID oder URL angegeben werden.', excludeEmptyString: true }),
        gnd: yup.string().trim().matches(patterns.gnd, { message: 'GND muss als numerische ID oder URL angegeben werden.', excludeEmptyString: true }),
        wikidata: yup.string().trim().matches(patterns.wikidata, { message: 'Wikidata-ID muss mit Q beginnen oder als URL vorliegen.', excludeEmptyString: true }),
        isni: yup.string().trim().matches(patterns.isni, { message: 'ISNI besteht aus 16 Ziffern (letzte kann X sein).', excludeEmptyString: true }),
        lcnaf: yup.string().trim().matches(patterns.lcnaf, { message: 'LCNAF muss als nXXXXXXXX oder entsprechende URL angegeben werden.', excludeEmptyString: true }),
        bnf: yup.string().trim().matches(patterns.bnf, { message: 'BNF muss als ark-ID oder URL angegeben werden.', excludeEmptyString: true }),
        bhl: yup.string().trim().matches(patterns.bhl, { message: 'BHL-ID muss numerisch oder als URL angegeben werden.', excludeEmptyString: true }),
        zoobank: yup.string().trim().matches(patterns.zoobank, { message: 'ZooBank erwartet eine gültige LSID.', excludeEmptyString: true }),
        zobodat: yup.string().trim().matches(patterns.zobodat, { message: 'ZOBODAT erwartet eine numerische ID oder URL.', excludeEmptyString: true }),
        wikipedia: yup.string().trim().matches(patterns.wikipedia, { message: 'Wikipedia-URL muss im Format https://xx.wikipedia.org/wiki/... vorliegen.', excludeEmptyString: true }),
        ulan: yup.string().trim().matches(patterns.ulan, { message: 'ULAN erwartet eine numerische ID ab 5000… oder entsprechende URL.', excludeEmptyString: true }),
        anmerkungen: yup.string().trim().matches(patterns.max2000, { message: 'Anmerkungen dürfen höchstens 2000 Zeichen umfassen.', excludeEmptyString: true }),
        kommentar: yup.string().trim().matches(patterns.max2000, { message: 'Kommentar darf höchstens 2000 Zeichen umfassen.', excludeEmptyString: true }),
        quelle: yup.string().trim().matches(patterns.ort255, { message: 'Quelle darf höchstens 255 Zeichen umfassen.', excludeEmptyString: true }),
        quelldaten: yup.string().trim().matches(patterns.max2000, { message: 'Quelldaten dürfen höchstens 2000 Zeichen umfassen.', excludeEmptyString: true }),
        quellimportDatum: yup.string().trim().matches(patterns.dateIso, { message: 'Datum bitte als YYYY-MM-DD angeben.', excludeEmptyString: true })
      });

      const normFields = [
        { name: 'orcid', label: 'ORCID', description: 'Eindeutige Kennung für Forschende (heute lebend).', hint: 'Format: 0000-0000-0000-000X oder URL.' },
        { name: 'viaf', label: 'VIAF', description: 'Internationale Normdatei (VIAF ID).', hint: 'Numerische ID oder https://viaf.org/viaf/ID.' },
        { name: 'gnd', label: 'GND', description: 'Gemeinsame Normdatei (DNB).', hint: '1XXXXXXXX oder https://d-nb.info/gnd/1XXXXXXXX.' },
        { name: 'wikidata', label: 'Wikidata', description: 'Wikidata-Eintrag.', hint: 'Q-ID oder https://www.wikidata.org/entity/Q…' },
        { name: 'isni', label: 'ISNI', description: 'Internationale Standardnummer.', hint: '16-stellige ID (letzte Zeichen kann X sein).' },
        { name: 'lcnaf', label: 'LCNAF', description: 'Library of Congress Name Authority File.', hint: 'nXXXXXXXX oder http://id.loc.gov/authorities/names/nXXXXXXXX.' },
        { name: 'bnf', label: 'BNF', description: 'Bibliothèque nationale de France.', hint: 'ark:/12148/cb… oder entsprechende URL.' },
        { name: 'bhl', label: 'BHL', description: 'Biodiversity Heritage Library (Author ID).', hint: 'Numerische ID oder https://www.biodiversitylibrary.org/creator/…' },
        { name: 'zoobank', label: 'ZooBank', description: 'Zoologische Namensdatenbank.', hint: 'LSID im Format urn:lsid:zoobank.org:author:…' },
        { name: 'zobodat', label: 'ZOBODAT', description: 'Österreichische Biodatenbank.', hint: 'Numerische ID oder https://www.zobodat.at/personen.php?id=…' },
        { name: 'wikipedia', label: 'Wikipedia', description: 'Wikipedia-Seite.', hint: 'Vollständige URL inkl. Sprachkennung.' },
        { name: 'ulan', label: 'ULAN', description: 'Getty Union List of Artist Names.', hint: '5000… ID oder https://vocab.getty.edu/page/ulan/5000…' }
      ];

      const fieldIdMap = {
        vorname: 'vorname',
        nachname: 'nachname',
        mittelname: 'mittelname',
        anzeigename: 'anzeigename',
        namenskuerzel: 'namenskuerzel',
        aliase: 'aliase',
        aliasNamenskuerzel: 'aliasNamenskuerzel',
        adelstitel: 'adelstitel',
        akademischerTitel: 'akademischerTitel',
        geburtsdatum: 'geburtsdatum',
        sterbedatum: 'sterbedatum',
        lebensstatus: 'lebensstatus-lebend',
        geschlecht: 'geschlecht-option-maennlich',
        geburtsort: 'geburtsort',
        sterbeort: 'sterbeort',
        wirkungsorte: 'wirkungsorte',
        berufFunktion: 'berufFunktion',
        institution: 'institution',
        abteilung: 'abteilung',
        rolle: 'rolle',
        zeitraum: 'zeitraum',
        adresseRoh: 'adresseRoh',
        email: 'email',
        telefon: 'telefon',
        nhmwProfil: 'nhmwProfil',
        orcid: 'orcid',
        viaf: 'viaf',
        gnd: 'gnd',
        wikidata: 'wikidata',
        isni: 'isni',
        lcnaf: 'lcnaf',
        bnf: 'bnf',
        bhl: 'bhl',
        zoobank: 'zoobank',
        zobodat: 'zobodat',
        wikipedia: 'wikipedia',
        ulan: 'ulan',
        anmerkungen: 'anmerkungen',
        kommentar: 'kommentar',
        quelle: 'quelle',
        quelldaten: 'quelldaten',
        quellimportDatum: 'quellimportDatum'
      };

      return {
        schema,
        normFields,
        fieldVisibility,
        geschlechtOptions,
        form: {
          vorname: '',
          nachname: '',
          mittelname: '',
          anzeigename: '',
          namensvarianten: [''],
          aliase: '',
          aliasNamenskuerzel: '',
          namenskuerzel: '',
          adelstitel: '',
          akademischerTitel: '',
          geburtsdatum: '',
          sterbedatum: '',
          lebensstatus: '',
          geschlecht: [],
          geburtsort: '',
          sterbeort: '',
          wirkungsorte: '',
          berufFunktion: '',
          institution: '',
          abteilung: '',
          rolle: '',
          zeitraum: '',
          adresseRoh: '',
          email: '',
          telefon: '',
          nhmwProfil: '',
          orcid: '',
          viaf: '',
          gnd: '',
          wikidata: '',
          isni: '',
          lcnaf: '',
          bnf: '',
          bhl: '',
          zoobank: '',
          zobodat: '',
          wikipedia: '',
          ulan: '',
          anmerkungen: '',
          kommentar: '',
          quelle: '',
          quelldaten: '',
          quellimportDatum: ''
        },
        errors: {},
        success: false,
        init() {
          // Defensive: ensure tooltip buttons are not focusable via keyboard
          document.querySelectorAll('.tooltip-button').forEach(btn => btn.setAttribute('tabindex', '-1'));
        },
        inputClass(field) {
          return this.errors[field] ? 'border-red-500 focus:border-red-500 focus:ring-red-500' : 'border-slate-200 focus:border-sky-400 focus:ring-sky-400';
        },
        isFieldVisible(name) {
          const visibility = this.fieldVisibility[name];
          if (!visibility) return true;
          if (visibility.hideIfLiving && this.form.lebensstatus === 'lebend') return false;
          if (visibility.hideIfDead && this.form.lebensstatus === 'verstorben') return false;
          return true;
        },
        addNamensvariante() {
          this.form.namensvarianten.push('');
        },
        removeNamensvariante(index) {
          if (this.form.namensvarianten.length === 1) {
            this.form.namensvarianten[0] = '';
            return;
          }
          this.form.namensvarianten.splice(index, 1);
        },
        sanitize() {
          const cleaned = {};
          for (const [key, value] of Object.entries(this.form)) {
            if (Array.isArray(value)) {
              cleaned[key] = value.map(v => (typeof v === 'string' ? v.trim() : v)).filter(v => v !== '');
            } else if (typeof value === 'string') {
              cleaned[key] = value.trim();
            } else {
              cleaned[key] = value;
            }
          }
          return cleaned;
        },
        async submit() {
          this.errors = {};
          this.success = false;
          const payload = this.sanitize();
          try {
            await this.schema.validate(payload, { abortEarly: false });
            this.success = true;
            console.info('Validierte Eingaben', payload);
          } catch (err) {
            if (err.inner) {
              err.inner.forEach(issue => {
                if (!this.errors[issue.path]) {
                  this.errors[issue.path] = issue.message;
                }
              });
            } else if (err.path) {
              this.errors[err.path] = err.message;
            }
            this.focusFirstError();
          }
        },
        focusFirstError() {
          this.$nextTick(() => {
            const firstKey = Object.keys(this.errors)[0];
            if (!firstKey) return;
            let targetId = fieldIdMap[firstKey] || firstKey;
            const match = firstKey.match(/^namensvarianten\[(\d+)\]$/);
            if (match) {
              targetId = `namensvariante-${match[1]}`;
            }
            const element = document.getElementById(targetId);
            if (element) {
              element.focus({ preventScroll: false });
              element.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
          });
        },
        resetForm() {
          Object.assign(this.form, {
            vorname: '',
            nachname: '',
            mittelname: '',
            anzeigename: '',
            namensvarianten: [''],
            aliase: '',
            aliasNamenskuerzel: '',
            namenskuerzel: '',
            adelstitel: '',
            akademischerTitel: '',
            geburtsdatum: '',
            sterbedatum: '',
            lebensstatus: '',
            geschlecht: [],
            geburtsort: '',
            sterbeort: '',
            wirkungsorte: '',
            berufFunktion: '',
            institution: '',
            abteilung: '',
            rolle: '',
            zeitraum: '',
            adresseRoh: '',
            email: '',
            telefon: '',
            nhmwProfil: '',
            orcid: '',
            viaf: '',
            gnd: '',
            wikidata: '',
            isni: '',
            lcnaf: '',
            bnf: '',
            bhl: '',
            zoobank: '',
            zobodat: '',
            wikipedia: '',
            ulan: '',
            anmerkungen: '',
            kommentar: '',
            quelle: '',
            quelldaten: '',
            quellimportDatum: ''
          });
          this.errors = {};
          this.success = false;
        }
      };
    }
  </script>
</body>

</html>
