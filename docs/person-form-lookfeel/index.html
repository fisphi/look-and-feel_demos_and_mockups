<!DOCTYPE html>
<html lang="de" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personenverwaltung</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        /* Increased contrast for borders and text — pastel theme */
        :root {
            /* softer borders / text */
            --bs-border-color: #dde6ee;       /* pastel cool gray */
            --bs-body-color: #102428;         /* still readable, slightly softened */

            /* pastel accent palette */
            --bs-primary: #8fbce6;            /* pastel sky blue */
            --bs-primary-bg-subtle: rgba(143,188,230,0.08);
            --bs-success: #a8d5b7;            /* pastel mint */
            --bs-success-shadow: rgba(168,213,183,0.28);
            --bs-danger: #e7a8b0;             /* pastel rose */
            --bs-danger-shadow: rgba(231,168,176,0.28);
            --bs-muted: #9aa3ab;              /* soft gray for "unknown" */
            --bs-secondary-bg: #f6f8fb;       /* very pale background for disabled inputs */
            --bs-body-bg: #ffffff;
        }
        
        [data-bs-theme="dark"] {
            --bs-border-color: #51606a;
            --bs-body-color: #e8eef2;

            --bs-primary: #6fa0c9;
            --bs-primary-bg-subtle: rgba(111,160,201,0.08);
            --bs-success: #8bb99a;
            --bs-success-shadow: rgba(139,185,154,0.24);
            --bs-danger: #c77f88;
            --bs-danger-shadow: rgba(199,127,136,0.24);
            --bs-muted: #adb6bb;
            --bs-secondary-bg: #273237;
            --bs-body-bg: #0b1214;
        }
        
        .form-control,
        .form-select,
        textarea.form-control {
            border-color: var(--bs-border-color);
            color: var(--bs-body-color);
            background-color: var(--bs-body-bg);
        }
        
        .card {
            border-color: var(--bs-border-color);
            background-color: var(--bs-body-bg);
        }
        
        .table {
            --bs-table-border-color: var(--bs-border-color);
            color: var(--bs-body-color);
            background-color: transparent;
        }
        
        .sidebar {
            position: sticky;
            top: 20px;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
        }
        .form-section {
            scroll-margin-top: 20px;
        }
        .disabled-section {
            pointer-events: none;
        }
        .disabled-section .card-header {
            opacity: 1;
        }
        .disabled-section .card-body {
            opacity: 1;
        }
        .disabled-section .form-control,
        .disabled-section .form-select,
        .disabled-section textarea.form-control,
        .disabled-section .table {
            color: var(--bs-body-color) !important;
            opacity: 1 !important;
        }
        
        /* Gray out labels when input is disabled */
        label:has(+ input:disabled),
        label:has(+ .input-group input:disabled),
        label:has(+ .autocomplete-wrapper input:disabled),
        label:has(+ select:disabled),
        label:has(+ textarea:disabled) {
            color: #999 !important;
            opacity: 0.6;
        }
        
        [data-bs-theme="dark"] label:has(+ input:disabled),
        [data-bs-theme="dark"] label:has(+ .input-group input:disabled),
        [data-bs-theme="dark"] label:has(+ .autocomplete-wrapper input:disabled),
        [data-bs-theme="dark"] label:has(+ select:disabled),
        [data-bs-theme="dark"] label:has(+ textarea:disabled) {
            color: #aaa !important;
        }
        
        .disabled-section .form-control:disabled,
        .disabled-section .form-select:disabled,
        .disabled-section textarea.form-control:disabled {
            background-color: var(--bs-secondary-bg);
            opacity: 0.7;
        }
        
        .dynamic-field-row {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .autocomplete-wrapper {
            position: relative;
        }
        .autocomplete-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            z-index: 1000;
            max-height: 200px;
            overflow-y: auto;
            background: var(--bs-body-bg);
            border: 1px solid var(--bs-border-color);
            border-radius: 0.375rem;
            box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.15);
            display: none;
        }
        .autocomplete-dropdown.show {
            display: block;
        }
        .autocomplete-item {
            padding: 0.5rem 1rem;
            cursor: pointer;
        }
        .autocomplete-item:hover,
        .autocomplete-item.active {
            background-color: var(--bs-primary);
            color: white;
        }
        [data-bs-theme="dark"] .autocomplete-dropdown {
            background: var(--bs-dark);
        }
        
        /* Lebensstatus Radio Button Styling */
        .lebensstatus-option {
            flex: 1;
            position: relative;
        }
        .lebensstatus-option input[type="radio"] {
            position: absolute;
            opacity: 0;
        }
        .lebensstatus-option label {
            display: block;
            padding: 1rem;
            text-align: center;
            border: 2px solid var(--bs-border-color);
            border-radius: 0.375rem;
            cursor: pointer;
            transition: all 0.2s ease;
            background-color: var(--bs-body-bg);
            font-weight: 500;
        }
        .lebensstatus-option label:hover {
            border-color: var(--bs-primary);
            background-color: var(--bs-primary-bg-subtle);
        }
        
        /* Lebend - pastel Mint */
        .lebensstatus-option:has(#lebend) input[type="radio"]:checked + label {
            border-color: var(--bs-success);
            background-color: var(--bs-success);
            color: white;
            box-shadow: 0 0.125rem 0.25rem var(--bs-success-shadow);
        }
        .lebensstatus-option:has(#lebend) label:hover {
            border-color: var(--bs-success);
            background-color: rgba(168,213,183,0.12);
        }
        
        /* Verstorben - pastel Rose */
        .lebensstatus-option:has(#verstorben) input[type="radio"]:checked + label {
            border-color: var(--bs-danger);
            background-color: var(--bs-danger);
            color: white;
            box-shadow: 0 0.125rem 0.25rem var(--bs-danger-shadow);
        }
        .lebensstatus-option:has(#verstorben) label:hover {
            border-color: var(--bs-danger);
            background-color: rgba(231,168,176,0.12);
        }
        
        /* Unbekannt - soft gray */
        .lebensstatus-option:has(#unbekannt) input[type="radio"]:checked + label {
            border-color: var(--bs-muted);
            background-color: var(--bs-muted);
            color: white;
            box-shadow: 0 0.125rem 0.25rem rgba(154,163,171,0.18);
        }
        .lebensstatus-option:has(#unbekannt) label:hover {
            border-color: var(--bs-muted);
            background-color: rgba(154,163,171,0.08);
        }
        
        /* Row separators for Lebensdaten */
        .row-separator {
            border-bottom: 1px solid var(--bs-border-color);
            padding-bottom: 1rem;
            margin-bottom: 1rem;
        }
        .row-separator:last-child {
            border-bottom: none;
            padding-bottom: 0;
            margin-bottom: 0;
        }
    </style>
</head>
<body>
    <div class="container-fluid py-4">
        <div class="row justify-content-center">
            <!-- Main Form -->
            <div class="col-md-9 col-lg-8 col-xl-7 order-md-1" style="max-width: 800px;">
                <div data-bs-spy="scroll" data-bs-target="#navbar-sections" data-bs-smooth-scroll="true">
                    <h1 class="mb-4">Personenerfassung</h1>

                    <form id="personForm" novalidate>
                        
                        <!-- 0. USER-ROLLE (GATE) -->
                        <section id="userrolle" class="form-section mb-5">
                            <div class="card border-primary">
                                <div class="card-header bg-primary text-white">
                                    <h3 class="h5 mb-0">
                                        User-Rolle
                                        <small class="d-block mt-1 opacity-75">Wählen Sie eine User-Rolle:</small>
                                    </h3>
                                </div>
                                <div class="card-body">
                                    <div class="alert alert-info mb-3" role="alert">
                                        <i class="bi bi-shield-lock-fill me-2"></i>
                                        <strong>Wichtig:</strong> Ihre Rolle bestimmt, welche Bereiche Sie bearbeiten können.
                                    </div>
                                    <div class="row g-3">
                                        <div class="col-12">
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="radio" name="userrolle" id="rolle_kurator" value="kurator">
                                                <label class="form-check-label" for="rolle_kurator">
                                                    <strong>DB-Owner (Superadmin z.B: Kurator der PersonenDatenBank)</strong>
                                                    <br>
                                                    <small class="text-muted">Volle Bearbeitungsrechte für alle Sektionen</small>
                                                </label>
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="radio" name="userrolle" id="rolle_kustode" value="kustode">
                                                <label class="form-check-label" for="rolle_kustode">
                                                    <strong>Record-Owner (Sammlungsspezifische Admins z.B: Kustode / Kustodin der sammlungsspezifischen Personeneinträge)</strong>
                                                    <br>
                                                    <small class="text-muted">Lebensstatus und Identität sind schreibgeschützt</small>
                                                </label>
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="radio" name="userrolle" id="rolle_wissenschaftler" value="wissenschaftler">
                                                <label class="form-check-label" for="rolle_wissenschaftler">
                                                    <strong>Record-Editor (Wissenschaftliche Mitarbeiter)</strong>
                                                    <br>
                                                    <small class="text-muted">Lebensstatus, Identität und Kontakt sind schreibgeschützt</small>
                                                </label>
                                            </div>
                                            <div class="form-check mb-3">
                                                <input class="form-check-input" type="radio" name="userrolle" id="rolle_user" value="user">
                                                <label class="form-check-label" for="rolle_user">
                                                    <strong>User (sammlungsfremder Mitarbeiter, read-only)</strong>
                                                    <br>
                                                    <small class="text-muted">Nur Kommentare abgeben möglich</small>
                                                </label>
                                            </div>
                                            
                                            <hr class="my-3">
                                            
                                            <div class="alert alert-success mb-0" role="alert">
                                                <i class="bi bi-shield-lock-fill me-2"></i>
                                                <strong>Draft</strong> Rollen- und Berechtigungsdefinitionen sind ein erste Überlegung <i>[tbd]</i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- 1. LEBENSSTATUS (GATE) -->
                        <section id="lebensstatus" class="form-section mb-5 disabled-section" data-role-restriction="kustode,wissenschaftler,user">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="h5 mb-0">Lebensstatus</h3>
                                </div>
                                <div class="card-body">
                                    <div class="d-flex gap-3">
                                        <div class="lebensstatus-option">
                                            <input class="form-check-input" type="radio" name="lebensstatus" id="lebend" value="lebend">
                                            <label class="form-check-label" for="lebend">
                                                <i class="bi bi-person-check fs-4 d-block mb-2"></i>
                                                Lebend
                                            </label>
                                        </div>
                                        <div class="lebensstatus-option">
                                            <input class="form-check-input" type="radio" name="lebensstatus" id="verstorben" value="verstorben">
                                            <label class="form-check-label" for="verstorben">
                                                <i class="bi bi-person-x fs-4 d-block mb-2"></i>
                                                Verstorben
                                            </label>
                                        </div>
                                        <div class="lebensstatus-option">
                                            <input class="form-check-input" type="radio" name="lebensstatus" id="unbekannt" value="unbekannt">
                                            <label class="form-check-label" for="unbekannt">
                                                <i class="bi bi-question-circle fs-4 d-block mb-2"></i>
                                                Unbekannt
                                            </label>
                                        </div>
                                    </div>
                                    <div class="invalid-feedback d-block" id="lebensstatusError" style="display:none!important"></div>
                                </div>
                            </div>
                        </section>

                        <!-- 2. ANZEIGENAME -->
                        <section id="anzeigename" class="form-section mb-5 disabled-section" data-role-restriction="user">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="h5 mb-0">Anzeigename</h3>
                                </div>
                                <div class="card-body">
                                    <div class="row g-3">
                                        <div class="col-12">
                                            <label class="form-label">Anzeigename (automatisch generiert)</label>
                                            <div class="alert alert-secondary mb-1" role="alert">
                                                <strong id="anzeigeNameDisplay" class="fs-5">—</strong>
                                            </div>
                                            <!-- neue Zeile für Geburt/Tod/Wirkungszeitraum -->
                                            <div id="anzeigeNameDates" class="small text-muted mb-2"> </div>
                                            <div class="form-text">Der Anzeigename wird automatisch aus Vorname, Mittelname und Nachname zusammengesetzt. Am Ende erscheint statisch [Vogelsammlung].</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- 3. IDENTITÄT -->
                        <section id="identitaet" class="form-section mb-5 disabled-section" data-role-restriction="kustode,wissenschaftler,user">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="h5 mb-0">Identität</h3>
                                </div>
                                <div class="card-body">
                                    <div class="row g-3 row-separator">
                                        <div class="col-md-4">
                                            <label for="vorname" class="form-label">Vorname</label>
                                            <input type="text" class="form-control" id="vorname" name="vorname">
                                        </div>
                                        <div class="col-md-4">
                                            <label for="mittelname" class="form-label">Mittelname</label>
                                            <input type="text" class="form-control" id="mittelname" name="mittelname">
                                        </div>
                                        <div class="col-md-4">
                                            <label for="nachname" class="form-label">Nachname <span class="text-danger">*</span></label>
                                            <input type="text" class="form-control" id="nachname" name="nachname" required>
                                            <div class="invalid-feedback">Nachname ist erforderlich</div>
                                        </div>
                                        <div class="col-md-4">
                                            <label for="namenskuerzel" class="form-label">Namenskürzel</label>
                                            <input type="text" class="form-control" id="namenskuerzel" name="namenskuerzel">
                                        </div>
                                        <div class="col-md-8">
                                            <label class="form-label">Geschlecht</label>
                                            <div>
                                                <div class="form-check form-check-inline">
                                                    <input class="form-check-input" type="radio" name="geschlecht" id="geschlecht_m" value="m">
                                                    <label class="form-check-label" for="geschlecht_m">Männlich</label>
                                                </div>
                                                <div class="form-check form-check-inline">
                                                    <input class="form-check-input" type="radio" name="geschlecht" id="geschlecht_w" value="w">
                                                    <label class="form-check-label" for="geschlecht_w">Weiblich</label>
                                                </div>
                                                <div class="form-check form-check-inline">
                                                    <input class="form-check-input" type="radio" name="geschlecht" id="geschlecht_div" value="div">
                                                    <label class="form-check-label" for="geschlecht_div">Divers</label>
                                                </div>
                                                <div class="form-check form-check-inline">
                                                    <input class="form-check-input" type="radio" name="geschlecht" id="geschlecht_unbekannt" value="unbekannt">
                                                    <label class="form-check-label" for="geschlecht_unbekannt">Unbekannt</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="row g-3 row-separator">
                                        <div class="col-md-6">
                                            <label for="standes_und_amtstitel" class="form-label">Standes- und Amtstitel</label>
                                            <div class="autocomplete-wrapper">
                                                <input type="text" class="form-control autocomplete-input" 
                                                       id="standes_und_amtstitel" name="standes_und_amtstitel"
                                                       data-autocomplete="standesTitel">
                                                <div class="autocomplete-dropdown"></div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="akademischer_titel" class="form-label">Akademischer Titel</label>
                                            <div class="autocomplete-wrapper">
                                                <input type="text" class="form-control autocomplete-input" 
                                                       id="akademischer_titel" name="akademischer_titel"
                                                       data-autocomplete="akademischeTitel">
                                                <div class="autocomplete-dropdown"></div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="row g-3">
                                        <div class="col-12">
                                            <label class="form-label">Namensvarianten</label>
                                            <div id="namensvarianten-container">
                                                <!-- Pre-filled entries -->
                                                <div class="dynamic-field-row">
                                                    <input type="text" class="form-control flex-grow-1" name="namensvarianten[]" value="Johann von Müller">
                                                    <button type="button" class="btn btn-outline-danger btn-sm">
                                                        <i class="bi bi-trash"></i>
                                                    </button>
                                                </div>
                                                <div class="dynamic-field-row">
                                                    <input type="text" class="form-control flex-grow-1" name="namensvarianten[]" value="J. Müller">
                                                    <button type="button" class="btn btn-outline-danger btn-sm">
                                                        <i class="bi bi-trash"></i>
                                                    </button>
                                                </div>
                                                <div class="dynamic-field-row">
                                                    <input type="text" class="form-control flex-grow-1" name="namensvarianten[]" value="Hans Müller">
                                                    <button type="button" class="btn btn-outline-danger btn-sm">
                                                        <i class="bi bi-trash"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            <button type="button" class="btn btn-sm btn-outline-primary" data-dynamic-add="namensvarianten">
                                                <i class="bi bi-plus-circle"></i> Namensvariante hinzufügen
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- 4. LEBENSDATEN -->
                        <section id="lebensdaten" class="form-section mb-5 disabled-section" data-role-restriction="user">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="h5 mb-0">Lebensdaten</h3>
                                </div>
                                <div class="card-body">
                                    <div class="row g-3 row-separator">
                                        <div class="col-md-6">
                                            <label for="geburtsdatum" class="form-label">Geburtsdatum (EDTF)</label>
                                            <input type="text" class="form-control" id="geburtsdatum" name="geburtsdatum"
                                                   placeholder="YYYY oder YYYY-MM oder YYYY-MM-DD"
                                                   data-validate="edtf">
                                            <div class="form-text">Format: YYYY, YYYY-MM oder YYYY-MM-DD</div>
                                            <div class="invalid-feedback">Ungültiges EDTF-Format</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="geburtsort" class="form-label">Geburtsort</label>
                                            <input type="text" class="form-control" id="geburtsort" name="geburtsort">
                                        </div>
                                    </div>
                                    
                                    <div class="row g-3 row-separator">
                                        <div class="col-md-6">
                                            <label for="sterbedatum" class="form-label">Sterbedatum (EDTF)</label>
                                            <input type="text" class="form-control" id="sterbedatum" name="sterbedatum"
                                                   placeholder="YYYY oder YYYY-MM oder YYYY-MM-DD"
                                                   data-validate="edtf">
                                            <div class="form-text">Format: YYYY, YYYY-MM oder YYYY-MM-DD</div>
                                            <div class="invalid-feedback">Ungültiges EDTF-Format</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="sterbeort" class="form-label">Sterbeort</label>
                                            <input type="text" class="form-control" id="sterbeort" name="sterbeort">
                                        </div>
                                    </div>
                                    
                                    <div class="row g-3 row-separator">
                                        <div class="col-md-6">
                                            <label for="wirkungszeitraum_von" class="form-label">Wirkungszeitraum von (EDTF)</label>
                                            <input type="text" class="form-control" id="wirkungszeitraum_von" name="wirkungszeitraum_von"
                                                   placeholder="YYYY oder YYYY-MM oder YYYY-MM-DD"
                                                   data-validate="edtf">
                                            <div class="form-text">Format: YYYY, YYYY-MM oder YYYY-MM-DD</div>
                                            <div class="invalid-feedback">Ungültiges EDTF-Format</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="wirkungszeitraum_bis" class="form-label">Wirkungszeitraum bis (EDTF)</label>
                                            <input type="text" class="form-control" id="wirkungszeitraum_bis" name="wirkungszeitraum_bis"
                                                   placeholder="YYYY oder YYYY-MM oder YYYY-MM-DD"
                                                   data-validate="edtf">
                                            <div class="form-text">Format: YYYY, YYYY-MM oder YYYY-MM-DD</div>
                                            <div class="invalid-feedback">Ungültiges EDTF-Format</div>
                                        </div>
                                    </div>
                                    
                                    <div class="row g-3">
                                        <div class="col-12">
                                            <label class="form-label">Datum ohne Kontext (EDTF)</label>
                                            <div id="datum-ohne-kontext-container"></div>
                                            <button type="button" class="btn btn-sm btn-outline-primary" data-dynamic-add="datumOhneKontext">
                                                <i class="bi bi-plus-circle"></i> Datum hinzufügen
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- 5. TÄTIGKEITEN / ROLLEN -->
                        <section id="taetigkeiten" class="form-section mb-5 disabled-section" data-role-restriction="user">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="h5 mb-0">Tätigkeiten / Rollen</h3>
                                </div>
                                <div class="card-body">
                                    <div id="taetigkeiten-container">
                                        <!-- Tätigkeit 1 (Pre-filled) -->
                                        <div class="taetigkeiten-entry border rounded p-3 mb-3">
                                            <div class="d-flex justify-content-between align-items-center mb-3">
                                                <h6 class="mb-0">Tätigkeit #1</h6>
                                                <button type="button" class="btn btn-sm btn-outline-danger" onclick="this.closest('.taetigkeiten-entry').remove()">
                                                    <i class="bi bi-trash"></i> Entfernen
                                                </button>
                                            </div>
                                            <div class="row g-3">
                                                <div class="col-md-6">
                                                    <label class="form-label">Beruf / Funktion</label>
                                                    <input type="text" class="form-control" name="beruf_funktion[]" value="Kurator">
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">Institution</label>
                                                    <div class="autocomplete-wrapper">
                                                        <input type="text" class="form-control autocomplete-input" 
                                                               name="institution[]"
                                                               data-autocomplete="institutionen"
                                                               value="Naturhistorisches Museum Wien">
                                                        <div class="autocomplete-dropdown"></div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">Abteilung</label>
                                                    <input type="text" class="form-control" name="abteilung[]" value="Zoologie">
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">Zeitraum</label>
                                                    <input type="text" class="form-control" name="zeitraum[]"
                                                           placeholder="z.B. 1990-2000" value="2010-2024">
                                                </div>
                                                <div class="col-12">
                                                    <label class="form-label">Rollen</label>
                                                    <div class="rollen-container-1">
                                                        <div class="dynamic-field-row">
                                                            <div class="autocomplete-wrapper flex-grow-1">
                                                                <input type="text" class="form-control autocomplete-input" 
                                                                       name="rollen_1[]"
                                                                       data-autocomplete="rollen"
                                                                       value="Sammler">
                                                                <div class="autocomplete-dropdown"></div>
                                                            </div>
                                                            <button type="button" class="btn btn-outline-danger btn-sm">
                                                                <i class="bi bi-trash"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <button type="button" class="btn btn-sm btn-outline-primary" onclick="addRolleToEntry(this, 1)">
                                                        <i class="bi bi-plus-circle"></i> Rolle hinzufügen
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <button type="button" class="btn btn-outline-primary" id="addTaetigkeitBtn">
                                        <i class="bi bi-plus-circle"></i> Weitere Tätigkeit hinzufügen
                                    </button>
                                </div>
                            </div>
                        </section>

                        <!-- 6. ORTE -->
                        <section id="orte" class="form-section mb-5 disabled-section" data-role-restriction="user">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="h5 mb-0">Orte</h3>
                                </div>
                                <div class="card-body">
                                    <label class="form-label">Wirkungsorte</label>
                                    <div id="wirkungsorte-container"></div>
                                    <button type="button" class="btn btn-sm btn-outline-primary" data-dynamic-add="wirkungsorte">
                                        <i class="bi bi-plus-circle"></i> Wirkungsort hinzufügen
                                    </button>
                                </div>
                            </div>
                        </section>

                        <!-- 7. NORMDATEN -->
                        <section id="normdaten" class="form-section mb-5 disabled-section" data-role-restriction="user">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="h5 mb-0">Normdaten</h3>
                                </div>
                                <div class="card-body">
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label for="orcid" class="form-label">ORCID</label>
                                            <input type="text" class="form-control" id="orcid" name="orcid"
                                                   placeholder="0000-0000-0000-000X oder URL"
                                                   data-validate="orcid">
                                            <div class="invalid-feedback">Ungültiges ORCID-Format</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="viaf" class="form-label">VIAF</label>
                                            <input type="text" class="form-control" id="viaf" name="viaf"
                                                   placeholder="Zahl oder URL"
                                                   data-validate="viaf">
                                            <div class="invalid-feedback">Ungültiges VIAF-Format</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="gnd" class="form-label">GND</label>
                                            <input type="text" class="form-control" id="gnd" name="gnd"
                                                   placeholder="Zahl oder URL"
                                                   data-validate="gnd">
                                            <div class="invalid-feedback">Ungültiges GND-Format</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="wikidata" class="form-label">Wikidata</label>
                                            <input type="text" class="form-control" id="wikidata" name="wikidata"
                                                   placeholder="Q + Zahl"
                                                   data-validate="wikidata">
                                            <div class="invalid-feedback">Ungültiges Wikidata-Format (Q + Zahl)</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="isni" class="form-label">ISNI</label>
                                            <input type="text" class="form-control" id="isni" name="isni"
                                                   placeholder="16-stellig"
                                                   data-validate="isni">
                                            <div class="invalid-feedback">Ungültiges ISNI-Format (16 Ziffern)</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="lcnaf" class="form-label">LCNAF</label>
                                            <input type="text" class="form-control" id="lcnaf" name="lcnaf"
                                                   placeholder="n + Zahl"
                                                   data-validate="lcnaf">
                                            <div class="invalid-feedback">Ungültiges LCNAF-Format (n + Zahl)</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="bnf" class="form-label">BNF</label>
                                            <input type="text" class="form-control" id="bnf" name="bnf"
                                                   placeholder="cb + Zahl"
                                                   data-validate="bnf">
                                            <div class="invalid-feedback">Ungültiges BNF-Format (cb + Zahl)</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="bhl" class="form-label">BHL</label>
                                            <input type="text" class="form-control" id="bhl" name="bhl"
                                                   placeholder="Zahl oder URL"
                                                   data-validate="bhl">
                                            <div class="invalid-feedback">Ungültiges BHL-Format</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="zoobank" class="form-label">ZooBank</label>
                                            <input type="text" class="form-control" id="zoobank" name="zoobank"
                                                   placeholder="UUID/LSID"
                                                   data-validate="zoobank">
                                            <div class="invalid-feedback">Ungültiges ZooBank-Format</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="zobodat" class="form-label">ZOBODAT</label>
                                            <input type="text" class="form-control" id="zobodat" name="zobodat"
                                                   placeholder="URL"
                                                   data-validate="url">
                                            <div class="invalid-feedback">Ungültige URL</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="wikipedia" class="form-label">Wikipedia</label>
                                            <input type="text" class="form-control" id="wikipedia" name="wikipedia"
                                                   placeholder="URL"
                                                   data-validate="url">
                                            <div class="invalid-feedback">Ungültige URL</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="ulan" class="form-label">ULAN</label>
                                            <input type="text" class="form-control" id="ulan" name="ulan"
                                                   placeholder="Zahl oder URL"
                                                   data-validate="ulan">
                                            <div class="invalid-feedback">Ungültiges ULAN-Format</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="ipni" class="form-label">IPNI</label>
                                            <input type="text" class="form-control" id="ipni" name="ipni"
                                                   placeholder="URL"
                                                   data-validate="url">
                                            <div class="invalid-feedback">Ungültige URL</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- 8. KONTAKT (SENSITIV) -->
                        <section id="kontakt" class="form-section mb-5 disabled-section" data-role-restriction="wissenschaftler,user">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="h5 mb-0">Kontakt (Sensitiv)</h3>
                                </div>
                                <div class="card-body">
                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" id="einwilligung" name="einwilligung">
                                        <label class="form-check-label" for="einwilligung">
                                            <strong>Einwilligung liegt vor</strong>
                                        </label>
                                    </div>
                                    <div id="kontakt-fields">
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <label for="email" class="form-label">E-Mail</label>
                                                <input type="email" class="form-control" id="email" name="email"
                                                       data-validate="email">
                                                <div class="invalid-feedback">Ungültige E-Mail-Adresse</div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="telefon" class="form-label">Telefon</label>
                                                <input type="tel" class="form-control" id="telefon" name="telefon"
                                                       data-validate="telefon">
                                                <div class="invalid-feedback">Ungültige Telefonnummer</div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="mobil" class="form-label">Mobil</label>
                                                <input type="tel" class="form-control" id="mobil" name="mobil"
                                                       data-validate="telefon">
                                                <div class="invalid-feedback">Ungültige Mobilnummer</div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="fax" class="form-label">Fax</label>
                                                <input type="tel" class="form-control" id="fax" name="fax"
                                                       data-validate="telefon">
                                                <div class="invalid-feedback">Ungültige Faxnummer</div>
                                            </div>
                                            <div class="col-12">
                                                <label for="adresse_roh" class="form-label">Adresse</label>
                                                <textarea class="form-control" id="adresse_roh" name="adresse_roh" rows="3"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- 9. ANMERKUNGEN UND KOMMENTARE -->
                        <section id="meta" class="form-section mb-5 disabled-section" data-role-restriction="user">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="h5 mb-0">Anmerkungen und Kommentare</h3>
                                </div>
                                <div class="card-body">
                                    <div class="alert alert-info d-flex align-items-start mb-3" role="alert">
                                        <i class="bi bi-chat-left-text-fill me-2 fs-5"></i>
                                        <div>
                                            <strong>Hinweis:</strong> In diesem Bereich können Sie zusätzliche Informationen zur Person dokumentieren. 
                                            Nutzen Sie die Anmerkungen für ausführliche Notizen, den Kommentar für kurze Hinweise und die Quelle 
                                            zur Angabe der Herkunft der Informationen.
                                        </div>
                                    </div>

                                    <!-- Dummy Anmerkungen mit Kommentaren -->
                                    <div class="mb-4">
                                        <h6 class="mb-3">Bisherige Anmerkungen</h6>
                                        
                                        <!-- Anmerkung 1 -->
                                        <div class="card mb-3">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between align-items-start mb-2">
                                                    <div>
                                                        <strong class="text-primary">Dr. Maria Schmidt</strong>
                                                        <span class="badge bg-primary ms-2">Kuratorin</span>
                                                    </div>
                                                    <small class="text-muted">15.01.2024, 14:30</small>
                                                </div>
                                                <p class="mb-2">Die Geburtsdaten müssen noch verifiziert werden. Laut Archivunterlagen könnte das Geburtsjahr 1885 statt 1884 sein.</p>
                                                
                                                <!-- Kommentare zur Anmerkung 1 -->
                                                <div class="ms-4 mt-3 border-start border-3 border-secondary ps-3">
                                                    <div class="mb-3">
                                                        <div class="d-flex justify-content-between align-items-start mb-1">
                                                            <div>
                                                                <strong>Prof. Thomas Weber</strong>
                                                                <span class="badge bg-success ms-2">Administrator</span>
                                                            </div>
                                                            <small class="text-muted">15.01.2024, 16:45</small>
                                                        </div>
                                                        <p class="mb-0 small">Ich habe die Originalquelle geprüft - 1885 ist korrekt. Bitte aktualisieren.</p>
                                                    </div>
                                                    
                                                    <div class="mb-3">
                                                        <div class="d-flex justify-content-between align-items-start mb-1">
                                                            <div>
                                                                <strong>Anna Müller</strong>
                                                                <span class="badge bg-info ms-2">Bearbeiterin</span>
                                                            </div>
                                                            <small class="text-muted">16.01.2024, 09:15</small>
                                                        </div>
                                                        <p class="mb-0 small">Danke für die Klärung! Ich werde das Datum entsprechend anpassen.</p>
                                                    </div>
                                                </div>
                                                
                                                <button type="button" class="btn btn-sm btn-outline-secondary mt-2">
                                                    <i class="bi bi-chat-dots"></i> Kommentar abgeben
                                                </button>
                                            </div>
                                        </div>

                                        <!-- Anmerkung 2 -->
                                        <div class="card mb-3">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between align-items-start mb-2">
                                                    <div>
                                                        <strong class="text-primary">Mag. Johannes Kraft</strong>
                                                        <span class="badge bg-warning text-dark ms-2">Wissenschaftler</span>
                                                    </div>
                                                    <small class="text-muted">12.01.2024, 11:20</small>
                                                </div>
                                                <p class="mb-2">ORCID-Nummer wurde von der Person selbst bestätigt. Alle Publikationen sind korrekt zugeordnet.</p>
                                                
                                                <!-- Kommentare zur Anmerkung 2 -->
                                                <div class="ms-4 mt-3 border-start border-3 border-secondary ps-3">
                                                    <div class="mb-3">
                                                        <div class="d-flex justify-content-between align-items-start mb-1">
                                                            <div>
                                                                <strong>Dr. Maria Schmidt</strong>
                                                                <span class="badge bg-primary ms-2">Kuratorin</span>
                                                            </div>
                                                            <small class="text-muted">12.01.2024, 14:00</small>
                                                        </div>
                                                        <p class="mb-0 small">Sehr gut, danke für die Bestätigung!</p>
                                                    </div>
                                                </div>
                                                
                                                <button type="button" class="btn btn-sm btn-outline-secondary mt-2">
                                                    <i class="bi bi-chat-dots"></i> Kommentar abgeben
                                                </button>
                                            </div>
                                        </div>

                                        <!-- Anmerkung 3 -->
                                        <div class="card mb-3">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between align-items-start mb-2">
                                                    <div>
                                                        <strong class="text-primary">Lisa Berger</strong>
                                                        <span class="badge bg-secondary ms-2">Praktikantin</span>
                                                    </div>
                                                    <small class="text-muted">10.01.2024, 10:05</small>
                                                </div>
                                                <p class="mb-2">Bei der Recherche habe ich weitere Wirkungsorte gefunden: Graz (1920-1925) und Innsbruck (1925-1930). Soll ich diese ergänzen?</p>
                                                
                                                <!-- Kommentare zur Anmerkung 3 -->
                                                <div class="ms-4 mt-3 border-start border-3 border-secondary ps-3">
                                                    <div class="mb-3">
                                                        <div class="d-flex justify-content-between align-items-start mb-1">
                                                            <div>
                                                                <strong>Prof. Thomas Weber</strong>
                                                                <span class="badge bg-success ms-2">Administrator</span>
                                                            </div>
                                                            <small class="text-muted">10.01.2024, 11:30</small>
                                                        </div>
                                                        <p class="mb-0 small">Ja bitte, aber füge auch die Quellen hinzu.</p>
                                                    </div>
                                                    
                                                    <div class="mb-3">
                                                        <div class="d-flex justify-content-between align-items-start mb-1">
                                                            <div>
                                                                <strong>Lisa Berger</strong>
                                                                <span class="badge bg-secondary ms-2">Praktikantin</span>
                                                            </div>
                                                            <small class="text-muted">10.01.2024, 15:20</small>
                                                        </div>
                                                        <p class="mb-0 small">Erledigt! Quellen: Universitätsarchiv Graz, Personalakte Nr. 1234 und Tiroler Landesarchiv, Bestand XY.</p>
                                                    </div>

                                                    <div class="mb-3">
                                                        <div class="d-flex justify-content-between align-items-start mb-1">
                                                            <div>
                                                                <strong>Mag. Johannes Kraft</strong>
                                                                <span class="badge bg-warning text-dark ms-2">Wissenschaftler</span>
                                                            </div>
                                                            <small class="text-muted">11.01.2024, 08:45</small>
                                                        </div>
                                                        <p class="mb-0 small">Hervorragende Arbeit! Die Zeiträume passen auch zu den bekannten Publikationen.</p>
                                                    </div>
                                                </div>
                                                
                                                <button type="button" class="btn btn-sm btn-outline-secondary mt-2">
                                                    <i class="bi bi-chat-dots"></i> Kommentar abgeben
                                                </button>
                                            </div>
                                        </div>

                                        <!-- Button zum Hinzufügen neuer Anmerkungen -->
                                        <button type="button" class="btn btn-sm btn-outline-primary">
                                            <i class="bi bi-plus-circle"></i> Neue Anmerkung hinzufügen
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- 10. QUELLENANGABEN -->
                        <section id="quellenangaben" class="form-section mb-5 disabled-section" data-role-restriction="user">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="h5 mb-0">Quellenangaben</h3>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th style="width: 55%;">Quellenangabe</th>
                                                    <th style="width: 25%;">Erfasst von</th>
                                                    <th style="width: 20%;">Datum</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>Universitätsarchiv Wien, Personalakte Nr. 5678/1920</td>
                                                    <td>
                                                        <strong>Dr. Maria Schmidt</strong>
                                                        <br>
                                                        <span class="badge bg-primary">Kuratorin</span>
                                                    </td>
                                                    <td>
                                                        <small class="text-muted">15.01.2024<br>14:30</small>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>Österreichisches Staatsarchiv, Bestand Naturhistorisches Museum, Karton 42</td>
                                                    <td>
                                                        <strong>Anna Müller</strong>
                                                        <br>
                                                        <span class="badge bg-info">Bearbeiterin</span>
                                                    </td>
                                                    <td>
                                                        <small class="text-muted">12.01.2024<br>10:15</small>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>Tiroler Landesarchiv, Nachlass Johann Müller, Sign. NL-JM-1885</td>
                                                    <td>
                                                        <strong>Lisa Berger</strong>
                                                        <br>
                                                        <span class="badge bg-secondary">Praktikantin</span>
                                                    </td>
                                                    <td>
                                                        <small class="text-muted">10.01.2024<br>15:20</small>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>Bibliothek des Naturhistorischen Museums, Katalog 1890-1920, S. 234</td>
                                                    <td>
                                                        <strong>Mag. Johannes Kraft</strong>
                                                        <br>
                                                        <span class="badge bg-warning text-dark">Wissenschaftler</span>
                                                    </td>
                                                    <td>
                                                        <small class="text-muted">08.01.2024<br>09:00</small>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    
                                    <button type="button" class="btn btn-sm btn-outline-primary mt-2">
                                        <i class="bi bi-plus-circle"></i> Neue Quellenangabe hinzufügen
                                    </button>
                                </div>
                            </div>
                        </section>

                        <!-- 11. IMPORTDATEN (READONLY) -->
                        <section id="import" class="form-section mb-5 disabled-section" data-role-restriction="user">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="h5 mb-0">Importdaten (Readonly)</h3>
                                </div>
                                <div class="card-body">
                                    <div class="row g-3">
                                        <div class="col-md-4">
                                            <label for="import_quelle" class="form-label">Import-Quelle</label>
                                            <input type="text" class="form-control" id="import_quelle" name="import_quelle" readonly disabled>
                                        </div>
                                        <div class="col-md-4">
                                            <label for="import_quelldaten" class="form-label">Import-Quelldaten</label>
                                            <input type="text" class="form-control" id="import_quelldaten" name="import_quelldaten" readonly disabled>
                                        </div>
                                        <div class="col-md-4">
                                            <label for="import_datum" class="form-label">Import-Datum</label>
                                            <input type="text" class="form-control" id="import_datum" name="import_datum" readonly disabled>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>

                    </form>
                </div>
            </div>

            <!-- Sidebar Navigation -->
            <div class="col-md-3 col-lg-2 order-md-2">
                <div class="sidebar">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5>Navigation</h5>
                        <button id="themeToggle" class="btn btn-sm btn-outline-secondary" title="Theme wechseln">
                            <i class="bi bi-moon-fill"></i>
                        </button>
                    </div>
                    <nav id="navbar-sections" class="nav flex-column">
                        <a class="nav-link" href="#userrolle">User-Rolle</a>
                        <a class="nav-link" href="#lebensstatus">Lebensstatus</a>
                        <a class="nav-link" href="#anzeigename">Anzeigename</a>
                        <a class="nav-link" href="#identitaet">Identität</a>
                        <a class="nav-link" href="#lebensdaten">Lebensdaten</a>
                        <a class="nav-link" href="#taetigkeiten">Tätigkeiten / Rollen</a>
                        <a class="nav-link" href="#orte">Orte</a>
                        <a class="nav-link" href="#normdaten">Normdaten</a>
                        <a class="nav-link" href="#kontakt">Kontakt</a>
                        <a class="nav-link" href="#meta">Anmerkungen und Kommentare</a>
                        <a class="nav-link" href="#quellenangaben">Quellenangaben</a>
                        <a class="nav-link" href="#import">Importdaten</a>
                    </nav>
                    <button id="exportJson" class="btn btn-primary w-100 mt-3">
                        <i class="bi bi-download"></i> JSON exportieren
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="autocomplete-data.js"></script>
    <script src="validation.js"></script>
    <script src="theme.js"></script>
    <script src="form.js"></script>
</body>
</html>
